import{aD as P,aH as M,r as y,w as U,o as A,f as q,e as t,b as e,$ as _,s as n,a2 as N,aF as x,a3 as k,d as C,D as R,aI as G,t as j,m as J}from"./index-CiDOeLWu.js";import{g as Q}from"./departement.servise-B8kbrx9W.js";import{a as I,V as z}from"./VForm-qgHvHQIG.js";import{V as $,b as B,d as L,c as W}from"./VCard-n0D_yEal.js";import{V as S}from"./VDivider-CuGzcyap.js";import{V as T,a as b}from"./VRow-D_iISvjp.js";import{V as E}from"./VAutocomplete-DC8GyFrt.js";import{V as F}from"./filter-BFoz8CfN.js";import{V as X}from"./VAvatar-D4RwvDF8.js";import{V as Y}from"./VDataTableVirtual-DCNim1Bg.js";import"./VImg-B3pZFRRB.js";import"./VList-DapNqBtX.js";import"./VCheckboxBtn-D_8YvquD.js";import"./VChip-Bs9IQbnU.js";async function Z(c={}){try{const{data:u}=await I.get("/v1/doctors/get-all",{params:c});return u}catch(u){throw console.error("API error:",u),u}}async function h(c){try{return await I.delete(`/v1/doctors/delete/${c}`)}catch(u){return u}}async function ee(c){try{return await I.post("/v1/doctors/add",c)}catch(u){return u}}async function le(c,u){try{return await I.put(`/v1/doctors/update/${c}`,u)}catch(i){return i}}const te=P("doctors",{state:()=>({headers:[{title:"№",align:"start",key:"id",sortable:!1},{title:"Имя пользователя",align:"start",key:"username"},{title:"Полное имя",align:"start",key:"full_name"},{title:"ID отдела",align:"start",key:"department_id"},{title:"Название отдела",align:"start",key:"department_name"},{title:"Специальность",align:"start",key:"speciality"},{title:"Действия",align:"start",key:"actions",sortable:!1}]}),actions:{}}),ae={__name:"addDoctorsInfo",props:{modelValue:{type:Boolean,default:!1},departmentList:{type:Array,default:()=>[]}},emits:["update:modelValue","added"],setup(c,{emit:u}){const i=c,g=u,p=M(),D=y(null),d=y(i.modelValue);U(()=>i.modelValue,l=>{d.value=l}),U(d,l=>{g("update:modelValue",l)});const s=y({username:"",full_name:"",department_id:null,speciality:"",password:""});function r(){d.value=!1}async function f(){var o;const{valid:l}=await D.value.validate();if(!l)return;const a={...s.value};try{const w=await ee(a);(w==null?void 0:w.status)===200||(w==null?void 0:w.status)===201?(p.success("Врач успешно добавлен!"),g("added"),r()):p.error(((o=w==null?void 0:w.data)==null?void 0:o.detail)||"Произошла ошибка при добавлении")}catch(w){console.error(w),p.error("Ошибка при подключении к серверу")}}return(l,a)=>(A(),q(F,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=o=>d.value=o),"max-width":"800"},{default:t(()=>[e($,{class:"pa-4"},{default:t(()=>[e(B,null,{default:t(()=>[e(_,{class:"me-2",color:"primary"},{default:t(()=>a[6]||(a[6]=[n(" mdi-doctor ")])),_:1}),a[7]||(a[7]=n(" Добавить врача "))]),_:1}),e(S,{class:"mb-4"}),e(z,{ref_key:"form",ref:D,onSubmit:N(f,["prevent"])},{default:t(()=>[e(T,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:s.value.full_name,"onUpdate:modelValue":a[0]||(a[0]=o=>s.value.full_name=o),label:"Полное имя","prepend-inner-icon":"mdi-account",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:s.value.username,"onUpdate:modelValue":a[1]||(a[1]=o=>s.value.username=o),label:"Имя пользователя","prepend-inner-icon":"mdi-account-circle-outline",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(E,{modelValue:s.value.department_id,"onUpdate:modelValue":a[2]||(a[2]=o=>s.value.department_id=o),items:i.departmentList,"item-title":"name","item-value":"id",label:"Отделение","prepend-inner-icon":"mdi-hospital-building",clearable:"",required:"",rules:[o=>!!o||"Выберите отделение"]},null,8,["modelValue","items","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:s.value.speciality,"onUpdate:modelValue":a[3]||(a[3]=o=>s.value.speciality=o),label:"Специальность","prepend-inner-icon":"mdi-stethoscope",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:s.value.password,"onUpdate:modelValue":a[4]||(a[4]=o=>s.value.password=o),label:"Пароль",type:"password","prepend-inner-icon":"mdi-lock",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(L,{class:"d-flex justify-end mt-4"},{default:t(()=>[e(k,{color:"error",onClick:r},{default:t(()=>[e(_,{left:""},{default:t(()=>a[8]||(a[8]=[n(" mdi-close ")])),_:1}),a[9]||(a[9]=n(" Отмена "))]),_:1}),e(k,{color:"success",type:"submit"},{default:t(()=>[e(_,{left:""},{default:t(()=>a[10]||(a[10]=[n(" mdi-content-save ")])),_:1}),a[11]||(a[11]=n(" Сохранить "))]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]))}},oe={__name:"DoctorEditDialog",props:{editDialog:{type:Boolean,default:!1},editingItem:{type:Object,default:()=>({})},departmentList:{type:Array,default:()=>[]}},emits:["updated","update:editDialog"],setup(c,{emit:u}){const i=c,g=u,p=M(),D=y(null),d=y({username:"",full_name:"",department_id:null,speciality:"",password:""});function s(){var f;g("update:editDialog",!1),(f=D.value)==null||f.reset()}U(()=>i.editDialog,f=>{if(f&&i.editingItem){const l=i.editingItem;d.value={username:(l==null?void 0:l.username)||"",full_name:(l==null?void 0:l.full_name)||"",department_id:(l==null?void 0:l.department_id)||null,speciality:(l==null?void 0:l.speciality)||"",password:""}}});async function r(){var a;const{valid:f}=await D.value.validate();if(!f)return;const l={username:d.value.username,full_name:d.value.full_name,department_id:d.value.department_id,speciality:d.value.speciality};d.value.password&&(l.password=d.value.password);try{const o=await le(i.editingItem.id,l);(o==null?void 0:o.status)===200?(p.success("Данные врача успешно обновлены!"),g("updated"),s()):p.error(((a=o==null?void 0:o.data)==null?void 0:a.detail)||"Ошибка при обновлении")}catch(o){console.error(o),p.error("Ошибка при подключении к серверу")}}return(f,l)=>(A(),q(F,{modelValue:i.editDialog,"onUpdate:modelValue":l[5]||(l[5]=a=>i.editDialog=a),"max-width":"600"},{default:t(()=>[e($,{class:"pa-4"},{default:t(()=>[e(B,null,{default:t(()=>[e(_,{class:"me-2",color:"primary"},{default:t(()=>l[6]||(l[6]=[n("mdi-account-edit")])),_:1}),l[7]||(l[7]=n(" Редактировать данные врача "))]),_:1}),e(S,{class:"mb-4"}),e(z,{ref_key:"form",ref:D,onSubmit:N(r,["prevent"])},{default:t(()=>[e(T,null,{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:d.value.full_name,"onUpdate:modelValue":l[0]||(l[0]=a=>d.value.full_name=a),label:"Полное имя","prepend-inner-icon":"mdi-account",required:"",rules:[a=>!!a||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:d.value.username,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.username=a),label:"Имя пользователя","prepend-inner-icon":"mdi-account-circle-outline",required:"",rules:[a=>!!a||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(E,{modelValue:d.value.department_id,"onUpdate:modelValue":l[2]||(l[2]=a=>d.value.department_id=a),items:i.departmentList,"item-title":"name","item-value":"id",label:"Отделение","prepend-inner-icon":"mdi-hospital-building",clearable:"",required:"",rules:[a=>!!a||"Выберите отделение"]},null,8,["modelValue","items","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:d.value.speciality,"onUpdate:modelValue":l[3]||(l[3]=a=>d.value.speciality=a),label:"Специальность","prepend-inner-icon":"mdi-stethoscope",required:"",rules:[a=>!!a||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(b,{cols:"12",md:"6"},{default:t(()=>[e(x,{modelValue:d.value.password,"onUpdate:modelValue":l[4]||(l[4]=a=>d.value.password=a),label:"Новый пароль (необязательно)",type:"password","prepend-inner-icon":"mdi-lock-reset"},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{class:"d-flex justify-end mt-4"},{default:t(()=>[e(k,{color:"error",onClick:s},{default:t(()=>[e(_,{left:""},{default:t(()=>l[8]||(l[8]=[n("mdi-close")])),_:1}),l[9]||(l[9]=n(" Отмена "))]),_:1}),e(k,{color:"success",type:"submit"},{default:t(()=>[e(_,{left:""},{default:t(()=>l[10]||(l[10]=[n("mdi-content-save-edit")])),_:1}),l[11]||(l[11]=n(" Сохранить "))]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]))}},de={__name:"doctorsDelete",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","close"],setup(c,{emit:u}){const i=u,g=c,p=y(g.modelValue);U(()=>g.modelValue,s=>p.value=s);function D(){p.value=!1,i("update:modelValue",!1),i("close")}function d(){i("confirm"),D()}return(s,r)=>(A(),q(F,{modelValue:p.value,"onUpdate:modelValue":r[0]||(r[0]=f=>p.value=f),"max-width":"420",transition:"dialog-bottom-transition",persistent:""},{default:t(()=>[e($,{class:"rounded-2xl py-6 px-4",elevation:"8"},{default:t(()=>[e(B,{class:"text-center"},{default:t(()=>[e(X,{size:"64",color:"error",class:"mb-2"},{default:t(()=>[e(_,{color:"white",size:"36"},{default:t(()=>r[1]||(r[1]=[n("mdi-delete-forever")])),_:1})]),_:1}),r[2]||(r[2]=C("div",{class:"text-h6 font-weight-bold"},"Удалить запись?",-1))]),_:1}),e(W,{class:"text-center text-body-2 text-medium-emphasis"},{default:t(()=>r[3]||(r[3]=[n(" Вы уверены, что хотите удалить эту запись?"),C("br",null,null,-1),n(" Это действие невозможно отменить. ")])),_:1}),e(L,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(k,{variant:"outlined",color:"grey",class:"rounded-xl px-6",onClick:D},{default:t(()=>[e(_,{left:""},{default:t(()=>r[4]||(r[4]=[n("mdi-close")])),_:1}),r[5]||(r[5]=n(" Отмена "))]),_:1}),e(k,{color:"error",class:"rounded-xl px-6",onClick:d},{default:t(()=>[e(_,{left:""},{default:t(()=>r[6]||(r[6]=[n("mdi-trash-can")])),_:1}),r[7]||(r[7]=n(" Удалить "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},re={style:{color:"#1976d2"}},ne={class:"d-flex"},xe={__name:"index",setup(c){const u=y(!1),i=te(),g=y({}),p=y([]),D=y(""),d=y(!1),s=y(!1),r=y(!1),f=y([]);async function l(){u.value=!0;try{const v={query:D.value||""},m=await Z(v);p.value=Array.isArray(m)?m:(m==null?void 0:m.data)||[]}catch(v){console.error("Ошибка:",v)}finally{u.value=!1}}async function a(){try{const v=await Q();f.value=v}catch(v){console.error(v)}}const o=async()=>{try{await h(g.value.id),await l()}catch(v){console.error(v)}};function w(){d.value=!0}function K(v){g.value=v,s.value=!0}function H(v){g.value=v,r.value=!0}return R(()=>{l(),a()}),(v,m)=>(A(),q($,{flat:""},{default:t(()=>[e(T,{class:"ma-2 align-center"},{default:t(()=>[e(b,{cols:"12",md:"6"},{default:t(()=>[e(B,null,{default:t(()=>m[4]||(m[4]=[n("Список врачей")])),_:1})]),_:1}),e(b,{cols:"12",md:"4"},{default:t(()=>[e(x,{modelValue:D.value,"onUpdate:modelValue":m[0]||(m[0]=V=>D.value=V),label:"Поиск...","prepend-icon":"mdi-magnify",onKeyup:G(l,["enter"])},null,8,["modelValue"])]),_:1}),e(b,{cols:"12",md:"2",class:"text-right"},{default:t(()=>[e(k,{color:"primary",onClick:w},{default:t(()=>m[5]||(m[5]=[n(" Добавить ")])),_:1})]),_:1})]),_:1}),e(S),e(Y,{headers:J(i).headers,items:p.value,loading:u.value,height:"70vh","loading-text":"Загрузка...","no-data-text":"Данные не найдены"},{"item.id":t(({index:V})=>[n(j(V+1),1)]),"item.username":t(({item:V})=>[C("span",re,j(V.username),1)]),"item.actions":t(({item:V})=>[C("div",ne,[e(k,{icon:"mdi-pencil-circle",variant:"plain",color:"warning",onClick:O=>K(V)},null,8,["onClick"]),e(k,{icon:"mdi-delete",variant:"plain",color:"error",onClick:O=>H(V)},null,8,["onClick"])])]),_:1},8,["headers","items","loading"]),e(ae,{modelValue:d.value,"onUpdate:modelValue":m[1]||(m[1]=V=>d.value=V),"department-list":f.value,onAdded:l},null,8,["modelValue","department-list"]),e(oe,{"edit-dialog":s.value,"onUpdate:editDialog":m[2]||(m[2]=V=>s.value=V),"department-list":f.value,"editing-item":g.value,onUpdated:l},null,8,["edit-dialog","department-list","editing-item"]),e(de,{modelValue:r.value,"onUpdate:modelValue":m[3]||(m[3]=V=>r.value=V),onConfirm:o},null,8,["modelValue"])]),_:1}))}};export{xe as default};
