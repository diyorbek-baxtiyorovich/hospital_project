import{aq as ve,r as y,ar as Y,o as q,c as D,b as a,e as i,s as k,a3 as w,d as V,a2 as ye,as as M,m as p,F as z,a8 as Ve,aK as ke,aL as Z,aM as be,ab as he,ak as xe,aN as _e,aO as Pe,X as P,aP as X,w as G,ac as we,aQ as Ie,aR as J,aS as Ce,aT as Se,p as j,aU as ze,aV as Fe,aW as Le,aX as Ae,J as qe,D as Be,f as Ue,$ as je,t as Q,h as De}from"./index-tQCl1PAq.js";import{a as B}from"./axios-DDd5p76N.js";import{V as R,b as T,d as Me,c as W}from"./VCard-Ds9TbtrS.js";import{V as Re}from"./VForm-DSE1NCOC.js";import{V as ee}from"./VAutocomplete-DDJzyYtv.js";import{V as ae}from"./VDialog-U6d3gm9U.js";import{a as A,V as Te}from"./VRow-Cpb91AQZ.js";import{V as $e,a as Ne}from"./VDataTableVirtual-DNj0ROkD.js";import{V as Ee}from"./filter-Cbdyj8Yi.js";import{V as Ke}from"./VChip-ujGnIvdd.js";import"./VAvatar-9D-c_Kgc.js";import"./VImg-CJiBNf-Q.js";import"./VList-DyuFgNlp.js";import"./VDivider-DlEJllXT.js";async function He(e){try{const{data:t}=await B.get("v1/loan-portfolio/get-all",{params:{page:e.page,size:e.size,loan_agen_id:e.loan_agent_id,query:e.query}});return t}catch(t){throw console.error(t),t}}async function Oe(){try{const{data:e}=await B.get("v1/loan-agent/get-agents");return e}catch(e){return e}}async function Xe(e){try{const{data:t}=await B.post("v1/loan-portfolio/upload",e,{headers:{"Content-Type":"multipart/form-data"}});return t}catch(t){throw console.error(t),t}}async function Je(e){try{const{data:t}=await B.put("v1/loan-portfolio/relate",e);return t}catch(t){return t}}const le=ve("loanPortfolio",{state:()=>({headers:[{title:"Id",align:"start",key:"id",sortable:!1},{title:"Mijoz F.I.SH",align:"start",key:"client_name"},{title:"Muddati o'tgan qarz miqdori",align:"start",key:"overdue_balance"},{title:"Kredit id",align:"start",key:"loan_id"},{title:"Agent F.I.SH",align:"start",key:"loan_agents"},{title:"Lokal kod",align:"start",key:"local_code"},{title:"...",align:"center",key:"actions"}],pageParams:{page:1,size:50,loan_agent_id:null,query:null},pageLength:1,loanPortfolioList:[],loading:!1,agentsList:[]}),actions:{async fetchLoanPortfolio(){this.loading=!0;try{const e=await He(this.pageParams);this.pageLength=(e==null?void 0:e.pages)||1,this.loanPortfolioList=e==null?void 0:e.items}catch(e){console.error("Error fetching loan portfolio:",e)}finally{this.loading=!1}},async fetchAgents(){this.loading=!0;try{this.agentsList=await Oe()}catch(e){console.error("Error fetching loan portfolio:",e)}}}}),Qe={class:"ma-2 d-flex justify-space-between"},We={class:"w-full d-flex justify-end mt-4"},Ye={__name:"AppendPortfolio",props:{updatingItem:Object},setup(e){const t=e,s=le(),m=y(null),r=y(!1),g=y(null),c=Y();async function b(){const{valid:h}=await g.value.validate();if(!h)return;r.value=!0;const o={loan_id:t.updatingItem.loan_id,loan_agent_id:t.updatingItem.loan_agent_id},d=await Je(o);r.value=!1,d.result==="Ok"&&(m.value=!1,await s.fetchLoanPortfolio(),c.success("Muvofaqqiyatli yangilandi."))}return(h,o)=>(q(),D(z,null,[a(w,{class:"ml-2",color:"primary",onClick:o[0]||(o[0]=d=>m.value=!0)},{default:i(()=>o[6]||(o[6]=[k(" Biriktirish ")])),_:1}),a(ae,{modelValue:m.value,"onUpdate:modelValue":o[5]||(o[5]=d=>m.value=d),"max-width":"600px"},{default:i(()=>[a(R,null,{default:i(()=>[V("div",Qe,[a(T,{class:"text-h5"},{default:i(()=>o[7]||(o[7]=[k(" Kredit portfelini biriktirish ")])),_:1}),a(w,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:o[1]||(o[1]=d=>m.value=!1)})]),a(Re,{ref_key:"form",ref:g,class:"pa-6",onSubmit:ye(b,["prevent"])},{default:i(()=>[a(M,{modelValue:t.updatingItem.client_name,"onUpdate:modelValue":o[2]||(o[2]=d=>t.updatingItem.client_name=d),label:"Mijoz F.I.SH",readonly:""},null,8,["modelValue"]),a(M,{modelValue:t.updatingItem.loan_id,"onUpdate:modelValue":o[3]||(o[3]=d=>t.updatingItem.loan_id=d),class:"mt-4",label:"Kredit ID",readonly:""},null,8,["modelValue"]),a(ee,{modelValue:t.updatingItem.loan_agent_id,"onUpdate:modelValue":o[4]||(o[4]=d=>t.updatingItem.loan_agent_id=d),items:p(s).agentsList,rules:[d=>!!d||"to'ldirish majburiy!"],class:"mt-4","item-title":"full_name","item-value":"loan_agent_id",label:"Agent",clearable:""},null,8,["modelValue","items","rules"]),V("div",We,[a(w,{loading:r.value,type:"submit"},{default:i(()=>o[8]||(o[8]=[k(" saqlash ")])),_:1},8,["loading"])])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])],64))}},Ze=Ve({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ke({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>Z(e).every(t=>t!=null&&typeof t=="object")},...be({clearable:!0})},"VFileInput"),Ge=he()({name:"VFileInput",inheritAttrs:!1,props:Ze(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,t){let{attrs:s,emit:m,slots:r}=t;const{t:g}=xe(),c=_e(e,"modelValue",e.modelValue,n=>Z(n),n=>!e.multiple&&Array.isArray(n)?n[0]:n),{isFocused:b,focus:h,blur:o}=Pe(e),d=P(()=>typeof e.showSize!="boolean"?e.showSize:void 0),v=P(()=>(c.value??[]).reduce((n,f)=>{let{size:I=0}=f;return n+I},0)),l=P(()=>X(v.value,d.value)),u=P(()=>(c.value??[]).map(n=>{const{name:f="",size:I=0}=n;return e.showSize?`${f} (${X(I,d.value)})`:f})),F=P(()=>{var f;const n=((f=c.value)==null?void 0:f.length)??0;return e.showSize?g(e.counterSizeString,n,l.value):g(e.counterString,n)}),$=y(),N=y(),x=y(),te=P(()=>b.value||e.active),E=P(()=>["plain","underlined"].includes(e.variant));function U(){var n;x.value!==document.activeElement&&((n=x.value)==null||n.focus()),b.value||h()}function ne(n){var f;(f=x.value)==null||f.click()}function oe(n){m("mousedown:control",n)}function ie(n){var f;(f=x.value)==null||f.click(),m("click:control",n)}function se(n){n.stopPropagation(),U(),Le(()=>{c.value=[],Ae(e["onClick:clear"],n)})}return G(c,n=>{(!Array.isArray(n)||!n.length)&&x.value&&(x.value.value="")}),we(()=>{const n=!!(r.counter||e.counter),f=!!(n||r.details),[I,ue]=Ie(s),{modelValue:la,...re}=J.filterProps(e),de=Ce(e);return a(J,j({ref:$,modelValue:c.value,"onUpdate:modelValue":C=>c.value=C,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":E.value},e.class],style:e.style,"onClick:prepend":ne},I,re,{centerAffix:!E.value,focused:b.value}),{...r,default:C=>{let{id:L,isDisabled:S,isDirty:K,isReadonly:H,isValid:fe}=C;return a(Se,j({ref:N,"prepend-icon":e.prependIcon,onMousedown:oe,onClick:ie,"onClick:clear":se,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},de,{id:L.value,active:te.value||K.value,dirty:K.value||e.dirty,disabled:S.value,focused:b.value,error:fe.value===!1}),{...r,default:me=>{var O;let{props:{class:ce,...pe}}=me;return a(z,null,[a("input",j({ref:x,type:"file",readonly:H.value,disabled:S.value,multiple:e.multiple,name:e.name,onClick:_=>{_.stopPropagation(),H.value&&_.preventDefault(),U()},onChange:_=>{if(!_.target)return;const ge=_.target;c.value=[...ge.files??[]]},onFocus:U,onBlur:o},pe,ue),null),a("div",{class:ce},[!!((O=c.value)!=null&&O.length)&&!e.hideInput&&(r.selection?r.selection({fileNames:u.value,totalBytes:v.value,totalBytesReadable:l.value}):e.chips?u.value.map(_=>a(Ke,{key:_,size:"small",text:_},null)):u.value.join(", "))])])}})},details:f?C=>{var L,S;return a(z,null,[(L=r.details)==null?void 0:L.call(r,C),n&&a(z,null,[a("span",null,null),a(ze,{active:!!((S=c.value)!=null&&S.length),value:F.value,disabled:e.disabled},r.counter)])])}:void 0})}),Fe({},$,N,x)}}),ea={class:"ma-2 d-flex justify-space-between"},aa={class:"w-full d-flex justify-end mt-4"},ya=qe({__name:"index",setup(e){const t=Y(),s=le(),m=y(!1),r=y(null);async function g(){await s.fetchLoanPortfolio()}function c(v){return v?Number(v).toLocaleString("uz-UZ"):"0"}function b(){s.pageParams.page=1,g()}const h=y(!1);async function o(){h.value=!0;try{const v=new FormData;v.append("file",r.value);const l=await Xe(v);t.success("Fayl muvaffaqiyatli yuklandi"),m.value=!1,await g()}catch{t.error("Faylni yuklashda xatolik yuz berdi")}finally{h.value=!1}}y(null);let d=null;return G(()=>s.pageParams.query,(v,l)=>{clearTimeout(d),d=setTimeout(()=>{s.pageParams.page=1,g()},600)}),Be(()=>{g(),s.fetchAgents()}),(v,l)=>(q(),Ue(R,null,{default:i(()=>[a(Te,{class:"ma-2"},{default:i(()=>[a(A,{cols:"12",md:"3"},{default:i(()=>[a(T,{class:"d-flex align-center pe-2"},{default:i(()=>l[8]||(l[8]=[k(" Kredit portfeli ")])),_:1})]),_:1}),a(A,{class:"d-flex",cols:"12",md:"3"},{default:i(()=>[a(ee,{modelValue:p(s).pageParams.loan_agent_id,"onUpdate:modelValue":[l[0]||(l[0]=u=>p(s).pageParams.loan_agent_id=u),g],items:p(s).agentsList,clearable:"","item-title":"full_name","item-value":"loan_agent_id",label:"Agent"},null,8,["modelValue","items"])]),_:1}),a(A,{class:"d-flex",cols:"12",md:"3"},{default:i(()=>[a(M,{modelValue:p(s).pageParams.query,"onUpdate:modelValue":l[1]||(l[1]=u=>p(s).pageParams.query=u),clearable:"",density:"compact","hide-details":"",label:"Mijoz F.I.SH","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),a(A,{class:"d-flex justify-end",cols:"12",md:"3"},{default:i(()=>[a(w,{onClick:l[2]||(l[2]=u=>m.value=!0)},{default:i(()=>[a(je,{class:"mr-1",icon:"mdi-file-excel",size:"25"}),l[9]||(l[9]=k(" yuklash "))]),_:1})]),_:1})]),_:1}),a(W,null,{default:i(()=>[a($e,{headers:p(s).headers,items:p(s).loanPortfolioList,loading:p(s).loading,"fixed-header":"",height:"65vh","hide-default-footer":"","loading-text":"ma'lumotlar yuklanmoqda","no-data-text":"ma'lumot topilmadi"},{"item.overdue_balance":i(({item:u})=>[k(Q(c(u.overdue_balance)),1)]),"item.loan_agents":i(({item:u})=>[(q(!0),D(z,null,De(u.loan_agents,F=>(q(),D("div",{key:F.loan_agent_id},Q(F.full_name),1))),128))]),"item.actions":i(({item:u})=>[a(Ye,{"updating-item":u},null,8,["updating-item"])]),_:1},8,["headers","items","loading"]),a(Me,{class:"w-full d-flex justify-space-between mt-2"},{default:i(()=>[a(Ee,{modelValue:p(s).pageParams.size,"onUpdate:modelValue":[l[3]||(l[3]=u=>p(s).pageParams.size=u),b],items:[10,20,50],label:"Har bir sahifa","max-width":"150"},null,8,["modelValue"]),a(Ne,{modelValue:p(s).pageParams.page,"onUpdate:modelValue":[l[4]||(l[4]=u=>p(s).pageParams.page=u),g],length:p(s).pageLength,"total-visible":4,rounded:"circle"},null,8,["modelValue","length"])]),_:1})]),_:1}),a(ae,{modelValue:m.value,"onUpdate:modelValue":l[7]||(l[7]=u=>m.value=u),"max-width":"600px"},{default:i(()=>[a(R,null,{default:i(()=>[V("div",ea,[a(T,{class:"text-h5"},{default:i(()=>l[10]||(l[10]=[k(" Kredit portfeli ")])),_:1}),a(w,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:l[5]||(l[5]=u=>m.value=!1)})]),a(W,null,{default:i(()=>[a(Ge,{modelValue:r.value,"onUpdate:modelValue":l[6]||(l[6]=u=>r.value=u),accept:".xlsx, .xls, .csv",label:"Excel faylni tanlang",variant:"outlined"},null,8,["modelValue"]),l[12]||(l[12]=V("div",{class:"mt-2"},[V("span",{class:"text-caption text-secondary"},[k(" Excel faylni yuklash uchun shartlar: "),V("ul",null,[V("li",null,"Faylning kengaytmasi .xlsx, .xls yoki .csv bo'lishi kerak."),V("li",null,"Faylda mijozlar haqida to'liq ma'lumot bo'lishi zarur.")])])],-1)),V("div",aa,[a(w,{disabled:!r.value,loading:h.value,onClick:o},{default:i(()=>l[11]||(l[11]=[k(" Yuklash ")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}});export{ya as default};
