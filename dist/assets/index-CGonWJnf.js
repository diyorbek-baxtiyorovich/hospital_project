import{a as k}from"./axios-BZ-8xtlA.js";import{aD as H,aX as D,aV as K,r as T,o as p,f as $,e as l,b as e,a3 as y,$ as E,s as b,a2 as L,aW as N,m as _,b5 as P,J as A,c as R,d as s,V as z,b6 as O,x as Z,F as B,h as I,t as x,D as X,a7 as J}from"./index-Psq43fdt.js";import{V as C,a as M,b as F,c as V,d as Q}from"./VCard-BXEULYPC.js";import{V as Y}from"./VForm-jCnIGwFw.js";import{V as h,a as g}from"./VRow-CFYAQaPO.js";import{V as W,b as j}from"./filter-DCoQWpqP.js";import{V as ee}from"./VAutocomplete-Can-ypRQ.js";import{V as le}from"./VCheckbox-C1L_KeEt.js";import{V as te,a as U,b as ae,c as q}from"./VTabs-D4sIb4p7.js";import"./VAvatar-17awWU_I.js";import"./VImg-Cq_Frsvh.js";import"./VList-C2r0kw-4.js";import"./VDivider-Cv06wpGJ.js";import"./VCheckboxBtn-Dhzr_KXR.js";import"./VChip-BlyUjdVF.js";async function se(){const{data:a}=await k.get("/rbac/get-roles");if(a)return a}async function ne(){const{data:a}=await k.get("/rbac/get-permissions");if(a)return a}async function oe(a){const{data:t}=await k.get("/rbac/get-permissions",{params:{role_id:a}});return t}async function ie(a){const{data:t}=await k.post("/rbac/add-role",a);if(t)return t}async function re(a){const{data:t}=await k.put("/rbac/update-role",{name:a.name,level:a.level},{params:{role_id:a.id}});return t}async function ue(a){const{data:t}=await k.delete(`/v1/rbac/delete-role/${a}`);if(t)return t}async function de(a,t){const{data:d}=await k.put("/rbac/reappend-role-permissions",{role_id:t,permission_ids:a});return d}const w=H("rbac-role",{state:()=>({loading:!1,roles:[],role:{},permissions:[],isCreatingRole:!1,permissionsById:{},isEditingRole:!1,isDeletingRole:!1,currentRole:{}}),actions:{async fetchRbacRole(){try{this.loading=!0,this.roles=await se()}finally{this.loading=!1}},async fetchRbacPermissions(){try{this.loading=!0,this.permissions=await ne()}finally{this.loading=!1}},async fetchRbacPermissionsById(a){try{this.loading=!0,await this.fetchRbacPermissions(),this.permissionsById=await oe(a)}finally{this.loading=!1}},async update(a){return await re(a)},async createRole(a){return await ie(a)},async confirm(a){return await ue(a.id)},async changePermissions(a,t){return await de(a,t)}},getters:{}}),ce={__name:"RoleAdd",setup(a){const t=w(),d=D(),o=K({id:0,name:"",level:0}),i=w(),u=[r=>!!r||"Level тўлдирилиши шарт",r=>!isNaN(r)||"Level рақам бўлиши керак"],f=[r=>!!r||"Name тўлиқ исмини киритинг"],c=T(null);function v(){t.isCreatingRole=!1,c.value&&c.value.reset()}async function m(){c.value.validate()&&(await t.createRole(o),d.success("Фойдаланувчи мувофаққиятли қўшилди"),t.isCreatingRole=!1,c.value.reset(),await i.fetchRbacRole(),await i.fetchRbacPermissions())}return(r,n)=>(p(),$(W,{"model-value":_(t).isCreatingRole,class:"scrollable-content",persistent:"",scrollable:"",width:"1024"},{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(M,null,{append:l(()=>[e(y,{icon:"",onClick:v},{default:l(()=>[e(E,{icon:"tabler-x",size:"18"})]),_:1})]),default:l(()=>[e(F,{color:"primary",dark:"",height:"64"},{default:l(()=>n[2]||(n[2]=[b(" Yangi Role qo'shish ")])),_:1})]),_:1}),e(V,null,{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(V,null,{default:l(()=>[e(Y,{ref_key:"form",ref:c,onSubmit:L(m,["prevent"])},{default:l(()=>[e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(N,{id:"level",modelValue:o.level,"onUpdate:modelValue":n[0]||(n[0]=S=>o.level=S),rules:u,density:"compact",label:"Level",name:"level",outlined:"",required:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(N,{id:"name",modelValue:o.name,"onUpdate:modelValue":n[1]||(n[1]=S=>o.name=S),rules:f,density:"compact",label:"Name",name:"name",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(y,{class:"mt-5",color:"primary",type:"submit"},{default:l(()=>n[3]||(n[3]=[b(" Qo'shish ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},fe={__name:"RoleDelete",setup(a){const t=w(),d=w(),o=D(),{currentRole:i}=P(t);function u(){i.value={},t.isDeletingRole=!1}async function f(){await t.confirm(i.value)&&(o.success("Muvaffaqiyatli o'chirildi"),await d.fetchRbacRole(),await d.fetchRbacPermissions(),u())}return(c,v)=>(p(),$(W,{"model-value":_(t).isDeletingRole,class:"scrollable-content",persistent:"",scrollable:"",width:"1024"},{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(M,null,{append:l(()=>[e(y,{icon:"",onClick:u},{default:l(()=>[e(E,{icon:"tabler-x",size:"18"})]),_:1})]),default:l(()=>[e(F,{color:"primary",dark:"",height:"64"},{default:l(()=>v[0]||(v[0]=[b(" Rolni o'chirish ")])),_:1})]),_:1}),e(V,null,{default:l(()=>[e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(y,{class:"mx-2",color:"error",onClick:f},{default:l(()=>v[1]||(v[1]=[b(" Tasdiqlash ")])),_:1}),e(y,{class:"mx-2",color:"secondary",onClick:u},{default:l(()=>v[2]||(v[2]=[b(" Bekor qilish ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},me={__name:"RoleEdit",setup(a){const t=w(),d=D(),{currentRole:o}=P(t),i=T(null),u=[m=>!!m||"Name тўлиқ исмини киритинг"],f=[m=>!!m||"Level тўлдирилиши шарт",m=>!isNaN(m)||"Level рақам бўлиши керак"];function c(){t.isEditingRole=!1,o.value={},i.value&&i.value.reset()}async function v(){if(!i.value.validate())return;await t.update(o.value)&&(d.success("Muvofiqiyatli yangilandi."),c())}return(m,r)=>(p(),$(W,{"model-value":_(t).isEditingRole,class:"scrollable-content",persistent:"",scrollable:"",width:"1024"},{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(M,null,{append:l(()=>[e(y,{icon:"",onClick:c},{default:l(()=>[e(E,{icon:"tabler-x",size:"18"})]),_:1})]),default:l(()=>[e(F,{color:"primary",dark:"",height:"64"},{default:l(()=>r[2]||(r[2]=[b(" Фойдаланувчи маълумотларига ўзгартириш киритиш ")])),_:1})]),_:1}),e(V,null,{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(V,null,{default:l(()=>[e(Y,{ref_key:"form",ref:i,onSubmit:L(v,["prevent"])},{default:l(()=>[e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(N,{id:"level",modelValue:_(o).level,"onUpdate:modelValue":r[0]||(r[0]=n=>_(o).level=n),rules:f,density:"compact",label:"Level of role",name:"level",outlined:"",required:""},null,8,["modelValue"])]),_:1}),e(g,{cols:"12"},{default:l(()=>[e(N,{id:"name",modelValue:_(o).name,"onUpdate:modelValue":r[1]||(r[1]=n=>_(o).name=n),rules:u,density:"compact",label:"Name",name:"name",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(y,{class:"mt-5",color:"primary",type:"submit"},{default:l(()=>r[3]||(r[3]=[b(" Сақлаш ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},pe={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},_e={key:0},ve=["colspan"],be={class:"border"},Re={class:"cursor-pointer text-primary"},ye={class:"border"},ge={class:"border"},Ve={class:"border"},we=A({__name:"RolesList",setup(a){const t=w();function d(){t.isCreatingRole=!0}function o(u){t.isEditingRole=!0,t.currentRole=u}function i(u){t.isDeletingRole=!0,t.currentRole=u}return(u,f)=>(p(),R("div",null,[e(ce),e(fe),e(me),s("section",null,[e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(V,{class:"d-flex flex-wrap py-4 gap-4"},{default:l(()=>[f[1]||(f[1]=s("div",{class:"me-3",style:{width:"80px"}},null,-1)),e(z),s("div",pe,[e(y,{"prepend-icon":"tabler-plus",onClick:L(d,["prevent"])},{default:l(()=>f[0]||(f[0]=[b(" Add role ")])),_:1})])]),_:1}),e(V,null,{default:l(()=>[e(j,null,{default:l(()=>[f[2]||(f[2]=s("thead",null,[s("tr",null,[s("th",{class:"border",scope:"col"},[s("span",{class:"text-white"},"Id")]),s("th",{class:"border",scope:"col"},[s("span",{class:"text-white"},"Name")]),s("th",{class:"border",scope:"col"},[s("span",{class:"text-white"},"Level")]),s("th",{class:"border",scope:"col"})])],-1)),s("tbody",null,[_(t).loading?(p(),R("tr",_e,[s("td",{colspan:_(t).roles.length},[e(O,{height:2,indeterminate:""})],8,ve)])):Z("",!0),(p(!0),R(B,null,I(_(t).roles,c=>(p(),R("tr",{key:c.id},[s("td",be,[s("span",Re,x(c.id),1)]),s("td",ye,x(c.name),1),s("td",ge,x(c.level),1),s("td",Ve,[s("div",null,[e(y,{color:"warning",density:"default",icon:"mdi-pencil-circle",size:"x-large",variant:"plain",onClick:v=>o(c)},null,8,["onClick"]),e(y,{color:"error",density:"default",icon:"mdi-delete",size:"x-large",variant:"plain",onClick:v=>i(c)},null,8,["onClick"])])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]))}}),he={class:"cursor-pointer text-primary"},xe=A({__name:"Routes",setup(a){const t=w();return(d,o)=>(p(),R("section",null,[e(h,null,{default:l(()=>[e(g,{cols:"12"},{default:l(()=>[e(V,{class:"d-flex flex-wrap py-4 gap-4"},{default:l(()=>[o[0]||(o[0]=s("div",{class:"me-3",style:{width:"80px"}},null,-1)),e(z),o[1]||(o[1]=s("div",{class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},null,-1))]),_:1}),e(V,null,{default:l(()=>[e(j,{class:"overflow-x-auto",style:{"max-height":"60vh"}},{default:l(()=>[o[2]||(o[2]=s("thead",null,[s("tr",null,[s("th",{scope:"col"}," Id "),s("th",{scope:"col"}," Routes ")])],-1)),(p(!0),R(B,null,I(_(t).permissions,(i,u)=>(p(),R("tbody",{key:u},[(p(!0),R(B,null,I(_(t).permissions,f=>(p(),R("tr",{key:f.id},[s("td",null,[s("span",he,x(f.id),1)]),s("td",null,x(f.endpoint),1)]))),128))]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]))}}),Ce={class:"font-weight-bold"},ke=A({__name:"AppendedPermissions",setup(a){const t=w(),{permissions:d,permissionsById:o}=P(t),i=D(),u=T(1);async function f(){t.permissions.forEach(m=>{o.value.forEach(r=>{m.id===r.id&&(m.isPermitted=!0)})})}async function c(){const m=[];d.value.forEach(n=>{n.isPermitted&&m.push(n.id)}),await t.changePermissions(m,u.value)&&i.success("Menyu ruxsatnomalari muvaffaqiyatli o'zgartirildi")}async function v(m){await t.fetchRbacPermissionsById(m),await f()}return X(()=>{v(u.value)}),(m,r)=>(p(),$(C,{flat:""},{default:l(()=>[e(Q,null,{default:l(()=>[e(h,null,{default:l(()=>[e(g,{cols:"12",md:"4"}),e(g,{class:"mt-3",cols:"12",md:"8"},{default:l(()=>[e(ee,{modelValue:u.value,"onUpdate:modelValue":[r[0]||(r[0]=n=>u.value=n),r[1]||(r[1]=n=>v(u.value))],items:_(t).roles,"aria-autocomplete":"off",autocomplete:"off",dense:"","item-title":"name","item-value":"id",outlined:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),(p(!0),R(B,null,I(_(d),(n,S)=>(p(),R("div",{key:n.id,class:"gap-3 align-center ml-5 my-1 d-flex"},[s("span",Ce,x(S+1)+") ",1),e(le,{modelValue:n.isPermitted,"onUpdate:modelValue":G=>n.isPermitted=G,label:` ${n==null?void 0:n.name}`,class:"font-weight-bold"},null,8,["modelValue","onUpdate:modelValue","label"]),s("span",null,"path: "+x(n==null?void 0:n.endpoint),1)]))),128)),e(Q,null,{default:l(()=>[e(z),e(y,{color:"primary",onClick:c},{default:l(()=>r[2]||(r[2]=[b(" change permissions ")])),_:1})]),_:1})]),_:1}))}}),Fe={__name:"index",setup(a){const t=w(),d=T(0);return X(()=>{t.fetchRbacRole(),t.fetchRbacPermissions()}),(o,i)=>(p(),$(C,null,{default:l(()=>[e(V,null,{default:l(()=>[e(te,{modelValue:_(d),"onUpdate:modelValue":i[0]||(i[0]=u=>J(d)?d.value=u:null),class:"v-tabs-pill",grow:""},{default:l(()=>[e(U,null,{default:l(()=>i[2]||(i[2]=[b(" Роли ")])),_:1}),e(U,null,{default:l(()=>i[3]||(i[3]=[b(" Роуты ")])),_:1}),e(U,null,{default:l(()=>i[4]||(i[4]=[b(" Добавленные разрешения ")])),_:1})]),_:1},8,["modelValue"]),e(V,null,{default:l(()=>[e(ae,{modelValue:_(d),"onUpdate:modelValue":i[1]||(i[1]=u=>J(d)?d.value=u:null)},{default:l(()=>[e(q,{value:0},{default:l(()=>[e(we)]),_:1}),e(q,{value:1},{default:l(()=>[e(xe)]),_:1}),e(q,{value:2},{default:l(()=>[e(ke)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{Fe as default};
