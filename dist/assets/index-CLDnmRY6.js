import{a as le,d as te,u as ae,b as oe,c as ne}from"./departement.servise-B8kbrx9W.js";import{aD as ue,r as m,aH as T,o as L,f as j,e as t,b as e,s as p,aF as U,V as O,a3 as x,d as i,t as w,w as se,X as G,c as de,aJ as B,$ as re,a1 as K,p as Q,aG as W,F as ie,D as me,m as fe}from"./index-CiDOeLWu.js";import{V as F,b as I,d as R,c as Z}from"./VCard-n0D_yEal.js";import{V as h}from"./VForm-qgHvHQIG.js";import{V as Y}from"./filter-BFoz8CfN.js";import{_ as pe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as J}from"./VDivider-CuGzcyap.js";import{V as ee,a as $}from"./VRow-D_iISvjp.js";import{V as ve}from"./VDataTableVirtual-DCNim1Bg.js";import"./VAvatar-D4RwvDF8.js";import"./VImg-B3pZFRRB.js";import"./VList-DapNqBtX.js";import"./VCheckboxBtn-D_8YvquD.js";import"./VChip-Bs9IQbnU.js";const Ve=ue("departaments",{state:()=>({headers:[{title:"Id",align:"start",key:"id",sortable:!1},{title:"Nomi",align:"start",key:"name"},{title:"Standart kvota",align:"start",key:"default_quota"},{title:"Amallar",align:"end",key:"actions"}],pageParams:{page:1,size:50,for_month:null},pageLength:1,agentList:[],loading:!1}),actions:{}}),ge={__name:"AddDialog",props:{modelValue:Boolean},emits:["update:modelValue","refresh"],setup(C,{emit:k}){const s=C,v=k,b=m(null),g=m(!1),c=T(),d=m({name:"",default_quota:5});async function r(){if((await b.value.validate()).valid){g.value=!0;try{await le(d.value),c.success("Отдел успешно добавлен!"),v("refresh"),v("update:modelValue",!1)}catch{c.error("Произошла ошибка при добавлении отдела!")}finally{g.value=!1}}}return(V,a)=>(L(),j(Y,{modelValue:s.modelValue,"onUpdate:modelValue":a[3]||(a[3]=n=>s.modelValue=n),"max-width":"600",persistent:""},{default:t(()=>[e(F,{class:"pa-4"},{default:t(()=>[e(I,null,{default:t(()=>a[4]||(a[4]=[p("Добавить новый отдел")])),_:1}),e(h,{ref_key:"form",ref:b},{default:t(()=>[e(U,{modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=n=>d.value.name=n),label:"Название отдела",rules:[n=>!!n||"Обязательное поле"],class:"mb-5"},null,8,["modelValue","rules"]),e(U,{modelValue:d.value.default_quota,"onUpdate:modelValue":a[1]||(a[1]=n=>d.value.default_quota=n),modelModifiers:{number:!0},label:"Квота по умолчанию",type:"number",rules:[n=>n>=0||"Не может быть меньше 0"]},null,8,["modelValue","rules"])]),_:1},512),e(R,null,{default:t(()=>[e(O),e(x,{text:"",onClick:a[2]||(a[2]=n=>v("update:modelValue",!1))},{default:t(()=>a[5]||(a[5]=[p("Отмена")])),_:1}),e(x,{color:"primary",loading:g.value,onClick:r},{default:t(()=>a[6]||(a[6]=[p(" Сохранить ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ye={__name:"DeleteDialog",props:{modelValue:Boolean,item:Object},emits:["update:modelValue","refresh"],setup(C,{emit:k}){const s=C,v=k,b=m(!1),g=T();async function c(){b.value=!0;try{await te(s.item.department_id),g.success("Отдел успешно удалён!"),v("refresh"),v("update:modelValue",!1)}catch{g.error("Произошла ошибка при удалении отдела!")}finally{b.value=!1}}return(d,r)=>(L(),j(Y,{modelValue:s.modelValue,"onUpdate:modelValue":r[1]||(r[1]=V=>s.modelValue=V),"max-width":"500",persistent:""},{default:t(()=>[e(F,{class:"pa-4"},{default:t(()=>[e(I,{class:"text-center"},{default:t(()=>r[2]||(r[2]=[p(" Вы уверены, что хотите удалить эту запись? ")])),_:1}),e(Z,null,{default:t(()=>{var V,a;return[i("div",null,[r[3]||(r[3]=i("b",null,"Название:",-1)),p(" "+w((V=s.item)==null?void 0:V.name),1)]),i("div",null,[r[4]||(r[4]=i("b",null,"Квота:",-1)),p(" "+w((a=s.item)==null?void 0:a.default_quota),1)])]}),_:1}),e(R,null,{default:t(()=>[e(O),e(x,{text:"",onClick:r[0]||(r[0]=V=>v("update:modelValue",!1))},{default:t(()=>r[5]||(r[5]=[p("Отмена")])),_:1}),e(x,{color:"error",loading:b.value,onClick:c},{default:t(()=>r[6]||(r[6]=[p(" Удалить ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},be={__name:"EditDialog",props:{modelValue:Boolean,item:{type:Object,default:()=>({})}},emits:["update:modelValue","refresh"],setup(C,{emit:k}){const s=C,v=k,b=T(),g=m(null),c=m(!1),d=m({name:"",default_quota:0,is_active:!0});se(()=>s.item,V=>{V&&(d.value={name:V.name||"",default_quota:V.default_quota||0,is_active:V.is_active??!0})},{immediate:!0});async function r(){const{valid:V}=await g.value.validate();if(V){c.value=!0;try{const a={name:d.value.name,default_quota:Number(d.value.default_quota),is_active:!0},n=await ae(s.item.department_id,a);(n==null?void 0:n.status)===200||(n==null?void 0:n.status)===201?(b.success("Департамент успешно обновлён!"),v("refresh"),v("update:modelValue",!1)):b.error("Произошла ошибка при обновлении!")}catch(a){b.error("Ошибка соединения с сервером!"),console.error(a)}finally{c.value=!1}}}return(V,a)=>(L(),j(Y,{modelValue:s.modelValue,"onUpdate:modelValue":a[3]||(a[3]=n=>s.modelValue=n),"max-width":"600",persistent:""},{default:t(()=>[e(F,{class:"pa-4"},{default:t(()=>[e(I,{class:"text-h6 mb-4"},{default:t(()=>a[4]||(a[4]=[p(" Редактирование стандартной квоты ")])),_:1}),e(h,{ref_key:"form",ref:g},{default:t(()=>[e(U,{modelValue:d.value.name,"onUpdate:modelValue":a[0]||(a[0]=n=>d.value.name=n),label:"Название департамента",variant:"outlined",class:"mb-5",rules:[n=>!!n||"Обязательное поле"]},null,8,["modelValue","rules"]),e(U,{modelValue:d.value.default_quota,"onUpdate:modelValue":a[1]||(a[1]=n=>d.value.default_quota=n),modelModifiers:{number:!0},label:"Стандартная квота",type:"number",variant:"outlined",rules:[n=>n>=0||"Не может быть меньше 0"],class:"mb-5"},null,8,["modelValue","rules"])]),_:1},512),e(R,null,{default:t(()=>[e(O),e(x,{text:"",onClick:a[2]||(a[2]=n=>v("update:modelValue",!1))},{default:t(()=>a[5]||(a[5]=[p("Отмена")])),_:1}),e(x,{color:"primary",loading:c.value,onClick:r},{default:t(()=>a[6]||(a[6]=[p(" Сохранить ")])),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},ce={class:"d-flex justify-end"},De={class:"d-flex align-center mb-2"},xe={class:"flex-grow-1"},ke={__name:"InfoDialog",props:{modelValue:Boolean,item:{type:Object,default:()=>({})}},emits:["update:modelValue"],setup(C,{emit:k}){const s=C,v=k,b=T(),g=m(!1),c=m(!1),d=m(null),r=m(null),V=()=>{g.value=!0},a=async D=>{if(!D)return;const l=new Date(D),y=l.getFullYear(),S=String(l.getMonth()+1).padStart(2,"0"),A=String(l.getDate()).padStart(2,"0");d.value=`${y}-${S}-${A}`,c.value=!1},n=async()=>{const D={department_id:s.item.department_id,extra_slots:s.item.extra_slots,for_date:d.value};try{await oe(D),b.success("Данные успешно обновлены!"),g.value=!1}catch{b.error("Произошла ошибка!")}};function M(D){if(!D)return"-";const l=new Date(D);if(isNaN(l))return"-";const y=["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avgust","Sentyabr","Oktyabr","Noyabr","Dekabr"],S=String(l.getDate()).padStart(2,"0"),A=y[l.getMonth()],P=l.getFullYear(),H=String(l.getHours()).padStart(2,"0"),f=String(l.getMinutes()).padStart(2,"0");return`${S} ${A} ${P} yil, ${H}:${f}`}const z=G(()=>M(s.item.date)),E=G(()=>M(s.item.updated_at));return(D,l)=>(L(),de(ie,null,[e(Y,{modelValue:s.modelValue,"onUpdate:modelValue":l[2]||(l[2]=y=>s.modelValue=y),"max-width":"700",persistent:""},{default:t(()=>[e(F,{class:"pa-5 rounded-2xl elevation-3"},{default:t(()=>[e(I,{class:"text-h6 font-weight-bold d-flex align-center justify-space-between mb-3"},{default:t(()=>[l[8]||(l[8]=p(" Информация о департаменте ")),e(x,{icon:"mdi-close",size:"small",variant:"text",onClick:l[0]||(l[0]=y=>v("update:modelValue",!1))})]),_:1}),e(J,{class:"mb-5"}),e(ee,{dense:""},{default:t(()=>[e($,{cols:"12",md:"6"},{default:t(()=>[e(B,{class:"pa-3 rounded-lg bg-grey-lighten-4"},{default:t(()=>[l[9]||(l[9]=i("strong",null,"ID департамента:",-1)),l[10]||(l[10]=i("br",null,null,-1)),i("span",null,w(s.item.department_id),1)]),_:1})]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(B,{class:"pa-3 rounded-lg bg-grey-lighten-4"},{default:t(()=>[l[11]||(l[11]=i("strong",null,"Основная квота:",-1)),l[12]||(l[12]=i("br",null,null,-1)),i("span",null,w(s.item.base_slots),1)]),_:1})]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(B,{class:"pa-3 rounded-lg bg-grey-lighten-4"},{default:t(()=>[l[13]||(l[13]=i("strong",null,"Дополнительная квота:",-1)),l[14]||(l[14]=i("br",null,null,-1)),i("span",null,w(s.item.extra_slots),1)]),_:1})]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(B,{class:"pa-3 rounded-lg bg-grey-lighten-4"},{default:t(()=>[l[15]||(l[15]=i("strong",null,"Дата:",-1)),l[16]||(l[16]=i("br",null,null,-1)),i("span",null,w(z.value),1)]),_:1})]),_:1}),e($,{cols:"12",md:"6"},{default:t(()=>[e(B,{class:"pa-3 rounded-lg bg-grey-lighten-4"},{default:t(()=>[l[17]||(l[17]=i("strong",null,"Дата обновления:",-1)),l[18]||(l[18]=i("br",null,null,-1)),i("span",null,w(E.value),1)]),_:1})]),_:1})]),_:1}),e(J,{class:"my-4"}),i("div",ce,[e(x,{class:"mr-2",color:"success",variant:"flat",onClick:V},{default:t(()=>l[19]||(l[19]=[p(" Обновить ")])),_:1}),e(x,{color:"primary",variant:"flat",onClick:l[1]||(l[1]=y=>v("update:modelValue",!1))},{default:t(()=>l[20]||(l[20]=[p(" Закрыть ")])),_:1})])]),_:1})]),_:1},8,["modelValue"]),e(Y,{modelValue:g.value,"onUpdate:modelValue":l[7]||(l[7]=y=>g.value=y),"max-width":"500"},{default:t(()=>[e(F,null,{default:t(()=>[e(I,{class:"text-h5 bg-primary text-white"},{default:t(()=>l[21]||(l[21]=[p(" Обновление данных ")])),_:1}),e(Z,{class:"pt-4"},{default:t(()=>[i("div",De,[e(re,{color:"warning",size:"48",class:"mr-3"},{default:t(()=>l[22]||(l[22]=[p(" mdi-alert-circle-outline ")])),_:1}),i("div",xe,[l[23]||(l[23]=i("p",{class:"text-body-1 mb-2"}," Выберите дату для обновления квоты! ",-1)),e(K,{modelValue:c.value,"onUpdate:modelValue":l[5]||(l[5]=y=>c.value=y),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:y})=>[e(U,Q({modelValue:d.value,"onUpdate:modelValue":l[3]||(l[3]=S=>d.value=S),label:"Дата (ГГГГ-ММ-ДД)"},y,{"prepend-inner-icon":"mdi-calendar",readonly:""}),null,16,["modelValue"])]),default:t(()=>[e(W,{modelValue:r.value,"onUpdate:modelValue":[l[4]||(l[4]=y=>r.value=y),a],color:"primary"},null,8,["modelValue"])]),_:1},8,["modelValue"])])])]),_:1}),e(R,{class:"px-4 pb-4"},{default:t(()=>[e(O),e(x,{color:"grey",variant:"text",onClick:l[6]||(l[6]=y=>g.value=!1)},{default:t(()=>l[24]||(l[24]=[p(" Отмена ")])),_:1}),e(x,{color:"primary",variant:"flat",disabled:!d.value,onClick:n},{default:t(()=>l[25]||(l[25]=[p(" Обновить ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1},8,["modelValue"])],64))}},_e=pe(ke,[["__scopeId","data-v-115c3886"]]),we=["onClick"],$e={class:"d-flex"},Oe={__name:"index",setup(C){const k=m(!1),s=m(""),v=m(null),b=m(!1),g=m(null),c=m(!1),d=m(null),r=m([]),V=Ve(),a=m(!1),n=m(!1),M=m(!1),z=m([]);function E(){const f=new Date,u=f.getFullYear(),o=f.getMonth()+1;z.value=Array.from({length:o},(_,q)=>{const N=String(q+1).padStart(2,"0");return`${u}-${N}`})}async function D(){k.value=!0;try{const f={};v.value&&(f.date=v.value);const u=await ne(f);Array.isArray(u)?r.value=u.map(o=>{var _,q,N,X;return{name:((_=o.department)==null?void 0:_.name)||"-",default_quota:((q=o.department)==null?void 0:q.default_quota)??0,is_active:((N=o.department)==null?void 0:N.is_active)??!1,department_id:((X=o.department)==null?void 0:X.id)??null,id:o.id,base_slots:o.base_slots??0,extra_slots:o.extra_slots??0,date:o.date||"-",updated_at:o.updated_at||"-"}}):r.value=[]}catch(f){console.error("Ошибка:",f)}finally{k.value=!1}}const l=G(()=>s.value?r.value.filter(f=>{var u;return(u=f.name)==null?void 0:u.toLowerCase().includes(s.value.toLowerCase())}):r.value);function y(){a.value=!0}function S(f){d.value=f,c.value=!0}function A(f){d.value=f,n.value=!0}function P(f){d.value=f,M.value=!0}const H=async f=>{if(!f)return;const u=new Date(f),o=u.getFullYear(),_=String(u.getMonth()+1).padStart(2,"0"),q=String(u.getDate()).padStart(2,"0");v.value=`${o}-${_}-${q}`,b.value=!1,await D()};return me(()=>{D(),E()}),(f,u)=>(L(),j(F,{flat:""},{default:t(()=>[e(ee,{class:"ma-2 align-center"},{default:t(()=>[e($,{cols:"12",md:"2"},{default:t(()=>[e(I,null,{default:t(()=>u[8]||(u[8]=[p("Отделы")])),_:1})]),_:1}),e($,{cols:"12",md:"4"},{default:t(()=>[e(U,{modelValue:s.value,"onUpdate:modelValue":u[0]||(u[0]=o=>s.value=o),label:"Поиск...","append-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),e($,{cols:"12",md:"3"},{default:t(()=>[e(K,{modelValue:b.value,"onUpdate:modelValue":u[3]||(u[3]=o=>b.value=o),"close-on-content-click":!1,transition:"scale-transition","offset-y":"","min-width":"auto"},{activator:t(({props:o})=>[e(U,Q({modelValue:v.value,"onUpdate:modelValue":u[1]||(u[1]=_=>v.value=_),label:"Дата (YYYY-MM-DD)"},o,{"prepend-inner-icon":"mdi-calendar",placeholder:"2025-10-14"}),null,16,["modelValue"])]),default:t(()=>[e(W,{modelValue:g.value,"onUpdate:modelValue":[u[2]||(u[2]=o=>g.value=o),H],color:"primary"},null,8,["modelValue"])]),_:1},8,["modelValue"])]),_:1}),e($,{cols:"12",md:"2",class:"text-right"},{default:t(()=>[e(x,{color:"primary",onClick:y},{default:t(()=>u[9]||(u[9]=[p(" Добавить ")])),_:1})]),_:1})]),_:1}),e(J),e(ve,{headers:fe(V).headers,items:l.value,loading:k.value,height:"70vh","loading-text":"Загрузка...","no-data-text":"Данные не найдены"},{"item.id":t(({index:o})=>[p(w(o+1),1)]),"item.name":t(({item:o})=>[i("span",{class:"cursor-pointer",style:{color:"#338aff"},onClick:_=>S(o)},w(o.name),9,we)]),"item.actions":t(({item:o})=>[i("div",$e,[e(x,{icon:"mdi-pencil-circle",variant:"plain",color:"warning",onClick:_=>A(o)},null,8,["onClick"]),e(x,{icon:"mdi-delete",variant:"plain",color:"error",onClick:_=>P(o)},null,8,["onClick"])])]),_:1},8,["headers","items","loading"]),e(ge,{modelValue:a.value,"onUpdate:modelValue":u[4]||(u[4]=o=>a.value=o),onRefresh:D},null,8,["modelValue"]),e(be,{modelValue:n.value,"onUpdate:modelValue":u[5]||(u[5]=o=>n.value=o),item:d.value,onRefresh:D},null,8,["modelValue","item"]),e(ye,{modelValue:M.value,"onUpdate:modelValue":u[6]||(u[6]=o=>M.value=o),item:d.value,onRefresh:D},null,8,["modelValue","item"]),e(_e,{modelValue:c.value,"onUpdate:modelValue":u[7]||(u[7]=o=>c.value=o),item:d.value},null,8,["modelValue","item"])]),_:1}))}};export{Oe as default};
