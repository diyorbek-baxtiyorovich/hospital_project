import{aq as ve,r as y,ar as Y,o as q,c as M,b as a,e as u,s as k,a3 as w,d as V,a2 as ye,as as R,m as p,F as L,a8 as Ve,aK as ke,aL as Z,aM as be,ab as he,ak as xe,aN as _e,aO as Pe,X as _,aP as X,w as G,ac as we,aQ as Ie,aR as J,aS as Ce,aT as Se,p as $,aU as ze,aV as Fe,aW as Le,aX as Ae,J as De,D as Ue,f as qe,$ as Be,t as Q,h as je,a as $e}from"./index-BI3cAwc5.js";import{a as B}from"./axios-sOV5ytsM.js";import{V as T,b as N,d as Me,c as W}from"./VCard-Dy_fW5FT.js";import{V as Re}from"./VForm-D7ejy7R_.js";import{V as ee}from"./VAutocomplete-DxAX99OT.js";import{V as ae}from"./VDialog-BHCviuzb.js";import{a as U,V as Te}from"./VRow-Cs-TkuQA.js";import{V as Ne,a as Ee}from"./VDataTableVirtual-DI5PwFlw.js";import{V as Ke}from"./filter-CkhI2cjQ.js";import{V as Oe}from"./VChip-BliM4t7F.js";import"./VAvatar-CY4qMHfX.js";import"./VImg-ojEEosCI.js";import"./VList-COy-u5o3.js";import"./VDivider-B8cmkX7g.js";async function He(e){try{const{data:n}=await B.get("v1/loan-portfolio/get-all",{params:{page:e.page,size:e.size,loan_agen_id:e.loan_agent_id,query:e.query}});return n}catch(n){throw console.error(n),n}}async function Xe(){try{const{data:e}=await B.get("v1/loan-agent/get-agents");return e}catch(e){return e}}async function Je(e,n){try{const{data:o}=await B.post(`v1/loan-portfolio/upload?date_=${n}`,e,{headers:{"Content-Type":"multipart/form-data"}});return o}catch(o){throw console.error(o),o}}async function Qe(e){try{const{data:n}=await B.put("v1/loan-portfolio/relate",e);return n}catch(n){return n}}const le=ve("loanPortfolio",{state:()=>({headers:[{title:"Id",align:"start",key:"id",sortable:!1},{title:"Mijoz F.I.SH",align:"start",key:"client_name"},{title:"Muddati o'tgan qarz miqdori",align:"start",key:"overdue_balance"},{title:"Kredit id",align:"start",key:"loan_id"},{title:"Agent F.I.SH",align:"start",key:"loan_agents"},{title:"Lokal kod",align:"start",key:"local_code"},{title:"...",align:"center",key:"actions"}],pageParams:{page:1,size:50,loan_agent_id:null,query:null},pageLength:1,loanPortfolioList:[],loading:!1,agentsList:[]}),actions:{async fetchLoanPortfolio(){this.loading=!0;try{const e=await He(this.pageParams);this.pageLength=(e==null?void 0:e.pages)||1,this.loanPortfolioList=e==null?void 0:e.items}catch(e){console.error("Error fetching loan portfolio:",e)}finally{this.loading=!1}},async fetchAgents(){this.loading=!0;try{this.agentsList=await Xe()}catch(e){console.error("Error fetching loan portfolio:",e)}}}}),We={class:"ma-2 d-flex justify-space-between"},Ye={class:"w-full d-flex justify-end mt-4"},Ze={__name:"AppendPortfolio",props:{updatingItem:Object},setup(e){const n=e,o=le(),c=y(null),r=y(!1),v=y(null),d=Y();async function b(){const{valid:P}=await v.value.validate();if(!P)return;r.value=!0;const i={loan_id:n.updatingItem.loan_id,loan_agent_id:n.updatingItem.loan_agent_id},f=await Qe(i);r.value=!1,f.result==="Ok"&&(c.value=!1,await o.fetchLoanPortfolio(),d.success("Muvofaqqiyatli yangilandi."))}return(P,i)=>(q(),M(L,null,[a(w,{class:"ml-2",color:"primary",onClick:i[0]||(i[0]=f=>c.value=!0)},{default:u(()=>i[6]||(i[6]=[k(" Biriktirish ")])),_:1}),a(ae,{modelValue:c.value,"onUpdate:modelValue":i[5]||(i[5]=f=>c.value=f),"max-width":"600px"},{default:u(()=>[a(T,null,{default:u(()=>[V("div",We,[a(N,{class:"text-h5"},{default:u(()=>i[7]||(i[7]=[k(" Kredit portfelini biriktirish ")])),_:1}),a(w,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:i[1]||(i[1]=f=>c.value=!1)})]),a(Re,{ref_key:"form",ref:v,class:"pa-6",onSubmit:ye(b,["prevent"])},{default:u(()=>[a(R,{modelValue:n.updatingItem.client_name,"onUpdate:modelValue":i[2]||(i[2]=f=>n.updatingItem.client_name=f),label:"Mijoz F.I.SH",readonly:""},null,8,["modelValue"]),a(R,{modelValue:n.updatingItem.loan_id,"onUpdate:modelValue":i[3]||(i[3]=f=>n.updatingItem.loan_id=f),class:"mt-4",label:"Kredit ID",readonly:""},null,8,["modelValue"]),a(ee,{modelValue:n.updatingItem.loan_agent_id,"onUpdate:modelValue":i[4]||(i[4]=f=>n.updatingItem.loan_agent_id=f),items:p(o).agentsList,rules:[f=>!!f||"to'ldirish majburiy!"],class:"mt-4","item-title":"full_name","item-value":"loan_agent_id",label:"Agent",clearable:""},null,8,["modelValue","items","rules"]),V("div",Ye,[a(w,{loading:r.value,type:"submit"},{default:u(()=>i[8]||(i[8]=[k(" saqlash ")])),_:1},8,["loading"])])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])],64))}},Ge=Ve({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ke({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>Z(e).every(n=>n!=null&&typeof n=="object")},...be({clearable:!0})},"VFileInput"),ea=he()({name:"VFileInput",inheritAttrs:!1,props:Ge(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,n){let{attrs:o,emit:c,slots:r}=n;const{t:v}=xe(),d=_e(e,"modelValue",e.modelValue,t=>Z(t),t=>!e.multiple&&Array.isArray(t)?t[0]:t),{isFocused:b,focus:P,blur:i}=Pe(e),f=_(()=>typeof e.showSize!="boolean"?e.showSize:void 0),I=_(()=>(d.value??[]).reduce((t,m)=>{let{size:S=0}=m;return t+S},0)),g=_(()=>X(I.value,f.value)),l=_(()=>(d.value??[]).map(t=>{const{name:m="",size:S=0}=t;return e.showSize?`${m} (${X(S,f.value)})`:m})),A=_(()=>{var m;const t=((m=d.value)==null?void 0:m.length)??0;return e.showSize?v(e.counterSizeString,t,g.value):v(e.counterString,t)}),s=y(),C=y(),h=y(),te=_(()=>b.value||e.active),E=_(()=>["plain","underlined"].includes(e.variant));function j(){var t;h.value!==document.activeElement&&((t=h.value)==null||t.focus()),b.value||P()}function ne(t){var m;(m=h.value)==null||m.click()}function oe(t){c("mousedown:control",t)}function ie(t){var m;(m=h.value)==null||m.click(),c("click:control",t)}function se(t){t.stopPropagation(),j(),Le(()=>{d.value=[],Ae(e["onClick:clear"],t)})}return G(d,t=>{(!Array.isArray(t)||!t.length)&&h.value&&(h.value.value="")}),we(()=>{const t=!!(r.counter||e.counter),m=!!(t||r.details),[S,ue]=Ie(o),{modelValue:ta,...re}=J.filterProps(e),de=Ce(e);return a(J,$({ref:s,modelValue:d.value,"onUpdate:modelValue":z=>d.value=z,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":E.value},e.class],style:e.style,"onClick:prepend":ne},S,re,{centerAffix:!E.value,focused:b.value}),{...r,default:z=>{let{id:D,isDisabled:F,isDirty:K,isReadonly:O,isValid:fe}=z;return a(Se,$({ref:C,"prepend-icon":e.prependIcon,onMousedown:oe,onClick:ie,"onClick:clear":se,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},de,{id:D.value,active:te.value||K.value,dirty:K.value||e.dirty,disabled:F.value,focused:b.value,error:fe.value===!1}),{...r,default:me=>{var H;let{props:{class:ce,...pe}}=me;return a(L,null,[a("input",$({ref:h,type:"file",readonly:O.value,disabled:F.value,multiple:e.multiple,name:e.name,onClick:x=>{x.stopPropagation(),O.value&&x.preventDefault(),j()},onChange:x=>{if(!x.target)return;const ge=x.target;d.value=[...ge.files??[]]},onFocus:j,onBlur:i},pe,ue),null),a("div",{class:ce},[!!((H=d.value)!=null&&H.length)&&!e.hideInput&&(r.selection?r.selection({fileNames:l.value,totalBytes:I.value,totalBytesReadable:g.value}):e.chips?l.value.map(x=>a(Oe,{key:x,size:"small",text:x},null)):l.value.join(", "))])])}})},details:m?z=>{var D,F;return a(L,null,[(D=r.details)==null?void 0:D.call(r,z),t&&a(L,null,[a("span",null,null),a(ze,{active:!!((F=d.value)!=null&&F.length),value:A.value,disabled:e.disabled},r.counter)])])}:void 0})}),Fe({},s,C,h)}}),aa={class:"ma-2 d-flex justify-space-between"},la={class:"w-full d-flex justify-end mt-4"},Va=De({__name:"index",setup(e){const n=Y(),o=le(),c=y(null),r=y(!1),v=y(null);async function d(){await o.fetchLoanPortfolio()}function b(g){return g?Number(g).toLocaleString("uz-UZ"):"0"}function P(){o.pageParams.page=1,d()}const i=y(!1);async function f(){if(!v.value||!c.value){n.error("Sana va faylni kiritish shart!");return}i.value=!0;try{let g="";c.value instanceof Date?g=c.value.toISOString().slice(0,10):g=String(c.value);const l=new FormData;l.append("file",v.value);const A=await Je(l,g);n.success("Fayl muvaffaqiyatli yuklandi"),r.value=!1,await d()}catch{n.error("Faylni yuklashda xatolik yuz berdi")}finally{i.value=!1}}y(null);let I=null;return G(()=>o.pageParams.query,(g,l)=>{clearTimeout(I),I=setTimeout(()=>{o.pageParams.page=1,d()},600)}),Ue(()=>{d(),o.fetchAgents()}),(g,l)=>{const A=$e("VDateInput");return q(),qe(T,null,{default:u(()=>[a(Te,{class:"ma-2"},{default:u(()=>[a(U,{cols:"12",md:"3"},{default:u(()=>[a(N,{class:"d-flex align-center pe-2"},{default:u(()=>l[9]||(l[9]=[k(" Kredit portfeli ")])),_:1})]),_:1}),a(U,{class:"d-flex",cols:"12",md:"3"},{default:u(()=>[a(ee,{modelValue:p(o).pageParams.loan_agent_id,"onUpdate:modelValue":[l[0]||(l[0]=s=>p(o).pageParams.loan_agent_id=s),d],items:p(o).agentsList,clearable:"","item-title":"full_name","item-value":"loan_agent_id",label:"Agent"},null,8,["modelValue","items"])]),_:1}),a(U,{class:"d-flex",cols:"12",md:"3"},{default:u(()=>[a(R,{modelValue:p(o).pageParams.query,"onUpdate:modelValue":l[1]||(l[1]=s=>p(o).pageParams.query=s),clearable:"",density:"compact","hide-details":"",label:"Mijoz F.I.SH","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),a(U,{class:"d-flex justify-end",cols:"12",md:"3"},{default:u(()=>[a(w,{onClick:l[2]||(l[2]=s=>r.value=!0)},{default:u(()=>[a(Be,{class:"mr-1",icon:"mdi-file-excel",size:"25"}),l[10]||(l[10]=k(" yuklash "))]),_:1})]),_:1})]),_:1}),a(W,null,{default:u(()=>[a(Ne,{headers:p(o).headers,items:p(o).loanPortfolioList,loading:p(o).loading,"fixed-header":"",height:"65vh","hide-default-footer":"","loading-text":"ma'lumotlar yuklanmoqda","no-data-text":"ma'lumot topilmadi"},{"item.overdue_balance":u(({item:s})=>[k(Q(b(s.overdue_balance)),1)]),"item.loan_agents":u(({item:s})=>[(q(!0),M(L,null,je(s.loan_agents,C=>(q(),M("div",{key:C.loan_agent_id},Q(C.full_name),1))),128))]),"item.actions":u(({item:s})=>[a(Ze,{"updating-item":s},null,8,["updating-item"])]),_:1},8,["headers","items","loading"]),a(Me,{class:"w-full d-flex justify-space-between mt-2"},{default:u(()=>[a(Ke,{modelValue:p(o).pageParams.size,"onUpdate:modelValue":[l[3]||(l[3]=s=>p(o).pageParams.size=s),P],items:[10,20,50],label:"Har bir sahifa","max-width":"150"},null,8,["modelValue"]),a(Ee,{modelValue:p(o).pageParams.page,"onUpdate:modelValue":[l[4]||(l[4]=s=>p(o).pageParams.page=s),d],length:p(o).pageLength,"total-visible":4,rounded:"circle"},null,8,["modelValue","length"])]),_:1})]),_:1}),a(ae,{modelValue:r.value,"onUpdate:modelValue":l[8]||(l[8]=s=>r.value=s),"max-width":"600px"},{default:u(()=>[a(T,null,{default:u(()=>[V("div",aa,[a(N,{class:"text-h5"},{default:u(()=>l[11]||(l[11]=[k(" Kredit portfeli ")])),_:1}),a(w,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:l[5]||(l[5]=s=>r.value=!1)})]),a(W,null,{default:u(()=>[a(ea,{modelValue:v.value,"onUpdate:modelValue":l[6]||(l[6]=s=>v.value=s),accept:".xlsx, .xls, .csv",label:"Excel faylni tanlang",variant:"outlined"},null,8,["modelValue"]),a(A,{modelValue:c.value,"onUpdate:modelValue":l[7]||(l[7]=s=>c.value=s),label:"Sanani kiriting",variant:"outlined","prepend-icon":"mdi-calendar",class:"mt-4"},null,8,["modelValue"]),l[13]||(l[13]=V("div",{class:"mt-2"},[V("span",{class:"text-caption text-secondary"},[k(" Excel faylni yuklash uchun shartlar: "),V("ul",null,[V("li",null,"Faylning kengaytmasi .xlsx, .xls yoki .csv bo'lishi kerak."),V("li",null,"Faylda mijozlar haqida to'liq ma'lumot bo'lishi zarur.")])])],-1)),V("div",la,[a(w,{disabled:!v.value,loading:i.value,onClick:f},{default:u(()=>l[12]||(l[12]=[k(" Yuklash ")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}});export{Va as default};
