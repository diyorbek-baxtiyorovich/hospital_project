import{a as P}from"./axios-IRQqdfb-.js";import{a8 as ne,a$ as re,bk as ie,ab as ue,aW as de,b1 as ce,bl as fe,X as me,ac as pe,b3 as _e,b4 as X,b as e,p as Y,aD as be,aE as U,aC as ve,r as N,o as _,f as $,e as l,a3 as R,$ as q,s as v,a2 as L,aF as I,m as b,bm as F,J as z,c as y,d as n,V as M,bn as ye,x as Re,F as B,h as S,t as k,D as K,a7 as j}from"./index-CkcxXxdr.js";import{V as C,a as W,b as J,c as g,d as G}from"./VCard-Cx676qcg.js";import{V as O}from"./VForm-DxV_xTaH.js";import{V as x,a as V}from"./VRow-B_WkQqw9.js";import{V as Q}from"./VDialog-CYqvF-Aj.js";import{m as Ve,a as H,b as Z}from"./filter-Lx5_0yK4.js";import{V as ge}from"./VAutocomplete-Cd7t__Ox.js";import{a as he,b as E,V as xe,c as T}from"./VTabs-BlkPfDiE.js";import"./VAvatar-DBnLulyv.js";import"./VImg-DxCS7Hnw.js";import"./VList-CvdjHwQt.js";import"./VDivider-xt3MMd93.js";import"./VChip-1rQ_z4f2.js";const we=ne({...re(),...ie(Ve(),["inline"])},"VCheckbox"),ke=ue()({name:"VCheckbox",inheritAttrs:!1,props:we(),emits:{"update:modelValue":a=>!0,"update:focused":a=>!0},setup(a,t){let{attrs:d,slots:i}=t;const s=de(a,"modelValue"),{isFocused:u,focus:f,blur:c}=ce(a),p=fe(),m=me(()=>a.id||`checkbox-${p}`);return pe(()=>{const[o,r]=_e(d),w=X.filterProps(a),D=H.filterProps(a);return e(X,Y({class:["v-checkbox",a.class]},o,w,{modelValue:s.value,"onUpdate:modelValue":A=>s.value=A,id:m.value,focused:u.value,style:a.style}),{...i,default:A=>{let{id:ee,messagesId:le,isDisabled:te,isReadonly:ae,isValid:se}=A;return e(H,Y(D,{id:ee.value,"aria-describedby":le.value,disabled:te.value,readonly:ae.value},r,{error:se.value===!1,modelValue:s.value,"onUpdate:modelValue":oe=>s.value=oe,onFocus:f,onBlur:c}),i)}})}),{}}});async function Ce(){const{data:a}=await P.get("/v1/rbac/get-all-roles");if(a)return a}async function Pe(){const{data:a}=await P.get("/v1/rbac/get-all-routes");if(a)return a}async function $e(a){const{data:t}=await P.get(`/v1/rbac/get-role-permissions/${a}`);if(t)return t}async function Ie(a){const{data:t}=await P.post("/v1/rbac/add-role",a);if(t)return t}async function Be(a){const{data:t}=await P.put(`/v1/rbac/update-role/${a.id}`,a);if(t)return t}async function Se(a){const{data:t}=await P.delete(`/v1/rbac/delete-role/${a}`);if(t)return t}async function Ue(a,t){const{data:d}=await P.patch(`/v1/rbac/update-role-permissions/${t}`,a);if(d)return d}const h=be("rbac-role",{state:()=>({loading:!1,roles:[],role:{},permissions:[],isCreatingRole:!1,permissionsById:{},isEditingRole:!1,isDeletingRole:!1,currentRole:{}}),actions:{async fetchRbacRole(){try{this.loading=!0,this.roles=await Ce()}finally{this.loading=!1}},async fetchRbacPermissions(){try{this.loading=!0,this.permissions=await Pe()}finally{this.loading=!1}},async fetchRbacPermissionsById(a){try{this.loading=!0,await this.fetchRbacPermissions(),this.permissionsById=await $e(a)}finally{this.loading=!1}},async update(a){return await Be(a)},async createRole(a){return await Ie(a)},async confirm(a){return await Se(a.id)},async changePermissions(a,t){return await Ue(a,t)}},getters:{}}),Ne={__name:"RoleAdd",setup(a){const t=h(),d=U(),i=ve({id:0,name:"",level:0}),s=h(),u=[o=>!!o||"Level тўлдирилиши шарт",o=>!isNaN(o)||"Level рақам бўлиши керак"],f=[o=>!!o||"Name тўлиқ исмини киритинг"],c=N(null);function p(){t.isCreatingRole=!1,c.value&&c.value.reset()}async function m(){if(!c.value.validate())return;const o=await t.createRole(i);o!=null&&o.result&&(d.success("Фойдаланувчи мувофаққиятли қўшилди"),t.isCreatingRole=!1,c.value.reset(),await s.fetchRbacRole(),await s.fetchRbacPermissions())}return(o,r)=>(_(),$(Q,{"model-value":b(t).isCreatingRole,class:"scrollable-content",persistent:"",scrollable:"",width:"1024"},{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(W,null,{append:l(()=>[e(R,{icon:"",onClick:p},{default:l(()=>[e(q,{icon:"tabler-x",size:"18"})]),_:1})]),default:l(()=>[e(J,{color:"primary",dark:"",height:"64"},{default:l(()=>r[2]||(r[2]=[v(" Yangi Role qo'shish ")])),_:1})]),_:1}),e(g,null,{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(g,null,{default:l(()=>[e(O,{ref_key:"form",ref:c,onSubmit:L(m,["prevent"])},{default:l(()=>[e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(I,{id:"level",modelValue:i.level,"onUpdate:modelValue":r[0]||(r[0]=w=>i.level=w),rules:u,density:"compact",label:"Level",name:"level",outlined:"",required:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(I,{id:"name",modelValue:i.name,"onUpdate:modelValue":r[1]||(r[1]=w=>i.name=w),rules:f,density:"compact",label:"Name",name:"name",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(R,{class:"mt-5",color:"primary",type:"submit"},{default:l(()=>r[3]||(r[3]=[v(" Qo'shish ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},De={__name:"RoleDelete",setup(a){const t=h(),d=h(),i=U(),{currentRole:s}=F(t);function u(){s.value={},t.isDeletingRole=!1}async function f(){await t.confirm(s.value)&&(i.success("Muvaffaqiyatli o'chirildi"),await d.fetchRbacRole(),await d.fetchRbacPermissions(),u())}return(c,p)=>(_(),$(Q,{"model-value":b(t).isDeletingRole,class:"scrollable-content",persistent:"",scrollable:"",width:"1024"},{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(W,null,{append:l(()=>[e(R,{icon:"",onClick:u},{default:l(()=>[e(q,{icon:"tabler-x",size:"18"})]),_:1})]),default:l(()=>[e(J,{color:"primary",dark:"",height:"64"},{default:l(()=>p[0]||(p[0]=[v(" Rolni o'chirish ")])),_:1})]),_:1}),e(g,null,{default:l(()=>[e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(R,{class:"mx-2",color:"error",onClick:f},{default:l(()=>p[1]||(p[1]=[v(" Tasdiqlash ")])),_:1}),e(R,{class:"mx-2",color:"secondary",onClick:u},{default:l(()=>p[2]||(p[2]=[v(" Bekor qilish ")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ae={__name:"RoleEdit",setup(a){const t=h(),d=U(),{currentRole:i}=F(t),s=N(null),u=[m=>!!m||"Name тўлиқ исмини киритинг"],f=[m=>!!m||"Level тўлдирилиши шарт",m=>!isNaN(m)||"Level рақам бўлиши керак"];function c(){t.isEditingRole=!1,i.value={},s.value&&s.value.reset()}async function p(){if(!s.value.validate())return;await t.update(i.value)&&(d.success("Muvofiqiyatli yangilandi."),c())}return(m,o)=>(_(),$(Q,{"model-value":b(t).isEditingRole,class:"scrollable-content",persistent:"",scrollable:"",width:"1024"},{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(W,null,{append:l(()=>[e(R,{icon:"",onClick:c},{default:l(()=>[e(q,{icon:"tabler-x",size:"18"})]),_:1})]),default:l(()=>[e(J,{color:"primary",dark:"",height:"64"},{default:l(()=>o[2]||(o[2]=[v(" Фойдаланувчи маълумотларига ўзгартириш киритиш ")])),_:1})]),_:1}),e(g,null,{default:l(()=>[e(C,{flat:""},{default:l(()=>[e(g,null,{default:l(()=>[e(O,{ref_key:"form",ref:s,onSubmit:L(p,["prevent"])},{default:l(()=>[e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(I,{id:"level",modelValue:b(i).level,"onUpdate:modelValue":o[0]||(o[0]=r=>b(i).level=r),rules:f,density:"compact",label:"Level of role",name:"level",outlined:"",required:""},null,8,["modelValue"])]),_:1}),e(V,{cols:"12"},{default:l(()=>[e(I,{id:"name",modelValue:b(i).name,"onUpdate:modelValue":o[1]||(o[1]=r=>b(i).name=r),rules:u,density:"compact",label:"Name",name:"name",outlined:"",required:""},null,8,["modelValue"])]),_:1})]),_:1}),e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(R,{class:"mt-5",color:"primary",type:"submit"},{default:l(()=>o[3]||(o[3]=[v(" Сақлаш ")])),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model-value"]))}},Ee={class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},Te={key:0},qe=["colspan"],Le={class:"border"},Fe={class:"cursor-pointer text-primary"},ze={class:"border"},Me={class:"border"},We={class:"border"},Je=z({__name:"RolesList",setup(a){const t=h();function d(){t.isCreatingRole=!0}function i(u){t.isEditingRole=!0,t.currentRole=u}function s(u){t.isDeletingRole=!0,t.currentRole=u}return(u,f)=>(_(),y("div",null,[e(Ne),e(De),e(Ae),n("section",null,[e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(g,{class:"d-flex flex-wrap py-4 gap-4"},{default:l(()=>[f[1]||(f[1]=n("div",{class:"me-3",style:{width:"80px"}},null,-1)),e(M),n("div",Ee,[e(R,{"prepend-icon":"tabler-plus",onClick:L(d,["prevent"])},{default:l(()=>f[0]||(f[0]=[v(" Add role ")])),_:1})])]),_:1}),e(g,null,{default:l(()=>[e(Z,null,{default:l(()=>[f[2]||(f[2]=n("thead",null,[n("tr",null,[n("th",{class:"border",scope:"col"},[n("span",{class:"text-white"},"Id")]),n("th",{class:"border",scope:"col"},[n("span",{class:"text-white"},"Name")]),n("th",{class:"border",scope:"col"},[n("span",{class:"text-white"},"Level")]),n("th",{class:"border",scope:"col"})])],-1)),n("tbody",null,[b(t).loading?(_(),y("tr",Te,[n("td",{colspan:b(t).roles.length},[e(ye,{height:2,indeterminate:""})],8,qe)])):Re("",!0),(_(!0),y(B,null,S(b(t).roles,c=>(_(),y("tr",{key:c.id},[n("td",Le,[n("span",Fe,k(c.id),1)]),n("td",ze,k(c.name),1),n("td",Me,k(c.level),1),n("td",We,[n("div",null,[e(R,{color:"warning",density:"default",icon:"mdi-pencil-circle",size:"x-large",variant:"plain",onClick:p=>i(c)},null,8,["onClick"]),e(R,{color:"error",density:"default",icon:"mdi-delete",size:"x-large",variant:"plain",onClick:p=>s(c)},null,8,["onClick"])])])]))),128))])]),_:1})]),_:1})]),_:1})]),_:1})])]))}}),Qe={class:"cursor-pointer text-primary"},Xe=z({__name:"Routes",setup(a){const t=h();return(d,i)=>(_(),y("section",null,[e(x,null,{default:l(()=>[e(V,{cols:"12"},{default:l(()=>[e(g,{class:"d-flex flex-wrap py-4 gap-4"},{default:l(()=>[i[0]||(i[0]=n("div",{class:"me-3",style:{width:"80px"}},null,-1)),e(M),i[1]||(i[1]=n("div",{class:"app-user-search-filter d-flex align-center flex-wrap gap-4"},null,-1))]),_:1}),e(g,null,{default:l(()=>[e(Z,{class:"overflow-x-auto",style:{"max-height":"60vh"}},{default:l(()=>[i[2]||(i[2]=n("thead",null,[n("tr",null,[n("th",{scope:"col"}," Id "),n("th",{scope:"col"}," Routes ")])],-1)),(_(!0),y(B,null,S(b(t).permissions,(s,u)=>(_(),y("tbody",{key:u},[(_(!0),y(B,null,S(b(t).permissions,f=>(_(),y("tr",{key:f.id},[n("td",null,[n("span",Qe,k(f.id),1)]),n("td",null,k(f.endpoint),1)]))),128))]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]))}}),Ye={class:"font-weight-bold"},je=z({__name:"AppendedPermissions",setup(a){const t=h(),{permissions:d,permissionsById:i}=F(t),s=U(),u=N(1);async function f(){t.permissions.forEach(m=>{i.value.permissions.forEach(o=>{m.id===o.id&&(m.isPermitted=!0)})})}async function c(){const m=[];d.value.forEach(r=>{r.isPermitted&&m.push(r.id)}),await t.changePermissions(m,u.value)&&s.success("Menyu ruxsatnomalari muvaffaqiyatli o'zgartirildi")}async function p(m){await t.fetchRbacPermissionsById(m),await f()}return K(()=>{p(u.value)}),(m,o)=>(_(),$(C,{flat:""},{default:l(()=>[e(G,null,{default:l(()=>[e(x,null,{default:l(()=>[e(V,{cols:"12",md:"4"}),e(V,{class:"mt-3",cols:"12",md:"8"},{default:l(()=>[e(ge,{modelValue:u.value,"onUpdate:modelValue":[o[0]||(o[0]=r=>u.value=r),o[1]||(o[1]=r=>p(u.value))],items:b(t).roles,"aria-autocomplete":"off",autocomplete:"off",dense:"","item-title":"name","item-value":"id",outlined:""},null,8,["modelValue","items"])]),_:1})]),_:1})]),_:1}),(_(!0),y(B,null,S(b(d),(r,w)=>(_(),y("div",{key:r.id,class:"gap-3 align-center ml-5 my-1 d-flex"},[n("span",Ye,k(w+1)+") ",1),e(ke,{modelValue:r.isPermitted,"onUpdate:modelValue":D=>r.isPermitted=D,label:` ${r==null?void 0:r.name}`,class:"font-weight-bold"},null,8,["modelValue","onUpdate:modelValue","label"]),n("span",null,"path: "+k(r==null?void 0:r.endpoint),1)]))),128)),e(G,null,{default:l(()=>[e(M),e(R,{color:"primary",onClick:c},{default:l(()=>o[2]||(o[2]=[v(" change permissions ")])),_:1})]),_:1})]),_:1}))}}),ul={__name:"index",setup(a){const t=h(),d=N(0);return K(()=>{t.fetchRbacRole(),t.fetchRbacPermissions()}),(i,s)=>(_(),$(C,null,{default:l(()=>[e(g,null,{default:l(()=>[e(he,{modelValue:b(d),"onUpdate:modelValue":s[0]||(s[0]=u=>j(d)?d.value=u:null),class:"v-tabs-pill",grow:""},{default:l(()=>[e(E,null,{default:l(()=>s[2]||(s[2]=[v(" Роли ")])),_:1}),e(E,null,{default:l(()=>s[3]||(s[3]=[v(" Роуты ")])),_:1}),e(E,null,{default:l(()=>s[4]||(s[4]=[v(" Добавленные разрешения ")])),_:1})]),_:1},8,["modelValue"]),e(g,null,{default:l(()=>[e(xe,{modelValue:b(d),"onUpdate:modelValue":s[1]||(s[1]=u=>j(d)?d.value=u:null)},{default:l(()=>[e(T,{value:0},{default:l(()=>[e(Je)]),_:1}),e(T,{value:1},{default:l(()=>[e(Xe)]),_:1}),e(T,{value:2},{default:l(()=>[e(je)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}))}};export{ul as default};
