import{aq as ze,r as p,ar as ce,o as P,c as M,b as a,e as n,s as y,a3 as w,d as I,a2 as Le,as as ee,m as k,F as T,aK as Ae,a8 as me,ad as Fe,a9 as De,aL as Be,ax as $e,aB as Te,ae as je,aM as qe,af as Ue,aa as Re,ag as Me,aN as Ee,ab as fe,aO as ve,X as C,aI as Ne,aP as Oe,aQ as Ke,az as He,aE as Ye,an as Qe,aR as Xe,aj as Ze,al as We,Y as Ge,ak as ge,aS as Je,$ as ye,aA as oe,p as H,aT as ea,aU as pe,aV as aa,aW as la,aX as ie,w as Ve,ac as ta,aY as na,aZ as se,a_ as oa,a$ as ia,b0 as sa,b1 as ra,b2 as ua,b3 as da,D as ca,f as $,t as A,h as re,x as G,V as ma,a as fa}from"./index-2LEpCFXI.js";import{a as Z}from"./axios-CY9edo1_.js";import{V as Y,b as Q,d as ue,c as O}from"./VCard-CLWFabl1.js";import{V as va}from"./VForm-NJA79uPC.js";import{V as ke}from"./VAutocomplete-DNNhyQ4a.js";import{V as ae}from"./VDialog-BYW2rrRR.js";import{a as K,V as ga}from"./VRow-0YWJRDS7.js";import{V as ya,a as pa,b as Va}from"./VDataTableVirtual-C8ID_a-p.js";import{V as ka}from"./filter-DPaBL-VY.js";import{V as X}from"./VChip-CkzoBafT.js";import{V as J}from"./VDivider-BNx6VzR3.js";import"./VAvatar-Bly2Wxsk.js";import"./VImg-C83mZLVZ.js";import"./VList-5eaRKQjB.js";async function ba(e){try{const{data:s}=await Z.get("v1/loan-portfolio/get-all",{params:{page:e.page,size:e.size,loan_agen_id:e.loan_agent_id,query:e.query}});return s}catch(s){throw console.error(s),s}}async function xa(){try{const{data:e}=await Z.get("v1/loan-agent/get-agents");return e}catch(e){return e}}async function _a(e,s){try{const{data:r}=await Z.post(`v1/loan-portfolio/upload?date_=${s}`,e,{headers:{"Content-Type":"multipart/form-data"}});return r}catch(r){throw console.error(r),r}}async function ha(e){try{const{data:s}=await Z.put("v1/loan-portfolio/relate",e);return s}catch(s){return s}}const be=ze("loanPortfolio",{state:()=>({headers:[{title:"Id",align:"start",key:"id",sortable:!1},{title:"Mijoz F.I.SH",align:"start",key:"client_name"},{title:"Muddati o'tgan qarz miqdori",align:"start",key:"overdue_balance"},{title:"Kredit id",align:"start",key:"loan_id"},{title:"Agent F.I.SH",align:"start",key:"loan_agents"},{title:"Lokal kod",align:"start",key:"local_code"},{title:"...",align:"center",key:"actions"}],pageParams:{page:1,size:50,loan_agent_id:null,query:null},pageLength:1,loanPortfolioList:[],loading:!1,agentsList:[]}),actions:{async fetchLoanPortfolio(){this.loading=!0;try{const e=await ba(this.pageParams);this.pageLength=(e==null?void 0:e.pages)||1,this.loanPortfolioList=e==null?void 0:e.items}catch(e){console.error("Error fetching loan portfolio:",e)}finally{this.loading=!1}},async fetchAgents(){this.loading=!0;try{this.agentsList=await xa()}catch(e){console.error("Error fetching loan portfolio:",e)}}}}),Pa={class:"ma-2 d-flex justify-space-between"},Ca={class:"w-full d-flex justify-end mt-4"},Ia={__name:"AppendPortfolio",props:{updatingItem:Object},setup(e){const s=e,r=be(),o=p(null),d=p(!1),g=p(null),v=ce();async function V(){const{valid:m}=await g.value.validate();if(!m)return;d.value=!0;const u={loan_id:s.updatingItem.loan_id,loan_agent_id:s.updatingItem.loan_agent_id},f=await ha(u);d.value=!1,f.result==="Ok"&&(o.value=!1,await r.fetchLoanPortfolio(),v.success("Muvofaqqiyatli yangilandi."))}return(m,u)=>(P(),M(T,null,[a(w,{class:"ml-2",color:"primary",onClick:u[0]||(u[0]=f=>o.value=!0)},{default:n(()=>u[6]||(u[6]=[y(" Biriktirish ")])),_:1}),a(ae,{modelValue:o.value,"onUpdate:modelValue":u[5]||(u[5]=f=>o.value=f),"max-width":"600px"},{default:n(()=>[a(Y,null,{default:n(()=>[I("div",Pa,[a(Q,{class:"text-h5"},{default:n(()=>u[7]||(u[7]=[y(" Kredit portfelini biriktirish ")])),_:1}),a(w,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:u[1]||(u[1]=f=>o.value=!1)})]),a(va,{ref_key:"form",ref:g,class:"pa-6",onSubmit:Le(V,["prevent"])},{default:n(()=>[a(ee,{modelValue:s.updatingItem.client_name,"onUpdate:modelValue":u[2]||(u[2]=f=>s.updatingItem.client_name=f),label:"Mijoz F.I.SH",readonly:""},null,8,["modelValue"]),a(ee,{modelValue:s.updatingItem.loan_id,"onUpdate:modelValue":u[3]||(u[3]=f=>s.updatingItem.loan_id=f),class:"mt-4",label:"Kredit ID",readonly:""},null,8,["modelValue"]),a(ke,{modelValue:s.updatingItem.loan_agent_id,"onUpdate:modelValue":u[4]||(u[4]=f=>s.updatingItem.loan_agent_id=f),items:k(r).agentsList,rules:[f=>!!f||"to'ldirish majburiy!"],class:"mt-4","item-title":"full_name","item-value":"loan_agent_id",label:"Agent",clearable:""},null,8,["modelValue","items","rules"]),I("div",Ca,[a(w,{loading:d.value,type:"submit"},{default:n(()=>u[8]||(u[8]=[y(" saqlash ")])),_:1},8,["loading"])])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])],64))}},wa=Ae("v-alert-title"),Sa=["success","info","warning","error"],za=me({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Fe,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>Sa.includes(e)},...De(),...Be(),...$e(),...Te(),...je(),...qe(),...Ue(),...Re(),...Me(),...Ee({variant:"flat"})},"VAlert"),de=fe()({name:"VAlert",props:za(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{emit:r,slots:o}=s;const d=ve(e,"modelValue"),g=C(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),v=C(()=>({color:e.color??e.type,variant:e.variant})),{themeClasses:V}=Ne(e),{colorClasses:m,colorStyles:u,variantClasses:f}=Oe(v),{densityClasses:F}=Ke(e),{dimensionStyles:h}=He(e),{elevationClasses:L}=Ye(e),{locationStyles:j}=Qe(e),{positionClasses:S}=Xe(e),{roundedClasses:D}=Ze(e),{textColorClasses:b,textColorStyles:x}=We(Ge(e,"borderColor")),{t:l}=ge(),_=C(()=>({"aria-label":l(e.closeLabel),onClick(t){d.value=!1,r("click:close",t)}}));return()=>{const t=!!(o.prepend||g.value),B=!!(o.title||e.title),W=!!(o.close||e.closable);return d.value&&a(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},V.value,m.value,F.value,L.value,S.value,D.value,f.value,e.class],style:[u.value,h.value,j.value,e.style],role:"alert"},{default:()=>{var E,i;return[Je(!1,"v-alert"),e.border&&a("div",{key:"border",class:["v-alert__border",b.value],style:x.value},null),t&&a("div",{key:"prepend",class:"v-alert__prepend"},[o.prepend?a(oe,{key:"prepend-defaults",disabled:!g.value,defaults:{VIcon:{density:e.density,icon:g.value,size:e.prominent?44:28}}},o.prepend):a(ye,{key:"prepend-icon",density:e.density,icon:g.value,size:e.prominent?44:28},null)]),a("div",{class:"v-alert__content"},[B&&a(wa,{key:"title"},{default:()=>{var c;return[((c=o.title)==null?void 0:c.call(o))??e.title]}}),((E=o.text)==null?void 0:E.call(o))??e.text,(i=o.default)==null?void 0:i.call(o)]),o.append&&a("div",{key:"append",class:"v-alert__append"},[o.append()]),W&&a("div",{key:"close",class:"v-alert__close"},[o.close?a(oe,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var c;return[(c=o.close)==null?void 0:c.call(o,{props:_.value})]}}):a(w,H({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},_.value),null)])]}})}}}),La=me({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ea({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>pe(e).every(s=>s!=null&&typeof s=="object")},...aa({clearable:!0})},"VFileInput"),Aa=fe()({name:"VFileInput",inheritAttrs:!1,props:La(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,s){let{attrs:r,emit:o,slots:d}=s;const{t:g}=ge(),v=ve(e,"modelValue",e.modelValue,i=>pe(i),i=>!e.multiple&&Array.isArray(i)?i[0]:i),{isFocused:V,focus:m,blur:u}=la(e),f=C(()=>typeof e.showSize!="boolean"?e.showSize:void 0),F=C(()=>(v.value??[]).reduce((i,c)=>{let{size:q=0}=c;return i+q},0)),h=C(()=>ie(F.value,f.value)),L=C(()=>(v.value??[]).map(i=>{const{name:c="",size:q=0}=i;return e.showSize?`${c} (${ie(q,f.value)})`:c})),j=C(()=>{var c;const i=((c=v.value)==null?void 0:c.length)??0;return e.showSize?g(e.counterSizeString,i,h.value):g(e.counterString,i)}),S=p(),D=p(),b=p(),x=C(()=>V.value||e.active),l=C(()=>["plain","underlined"].includes(e.variant));function _(){var i;b.value!==document.activeElement&&((i=b.value)==null||i.focus()),V.value||m()}function t(i){var c;(c=b.value)==null||c.click()}function B(i){o("mousedown:control",i)}function W(i){var c;(c=b.value)==null||c.click(),o("click:control",i)}function E(i){i.stopPropagation(),_(),ua(()=>{v.value=[],da(e["onClick:clear"],i)})}return Ve(v,i=>{(!Array.isArray(i)||!i.length)&&b.value&&(b.value.value="")}),ta(()=>{const i=!!(d.counter||e.counter),c=!!(i||d.details),[q,xe]=na(r),{modelValue:$a,..._e}=se.filterProps(e),he=oa(e);return a(se,H({ref:S,modelValue:v.value,"onUpdate:modelValue":U=>v.value=U,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":l.value},e.class],style:e.style,"onClick:prepend":t},q,_e,{centerAffix:!l.value,focused:V.value}),{...d,default:U=>{let{id:N,isDisabled:R,isDirty:le,isReadonly:te,isValid:Pe}=U;return a(ia,H({ref:D,"prepend-icon":e.prependIcon,onMousedown:B,onClick:W,"onClick:clear":E,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},he,{id:N.value,active:x.value||le.value,dirty:le.value||e.dirty,disabled:R.value,focused:V.value,error:Pe.value===!1}),{...d,default:Ce=>{var ne;let{props:{class:Ie,...we}}=Ce;return a(T,null,[a("input",H({ref:b,type:"file",readonly:te.value,disabled:R.value,multiple:e.multiple,name:e.name,onClick:z=>{z.stopPropagation(),te.value&&z.preventDefault(),_()},onChange:z=>{if(!z.target)return;const Se=z.target;v.value=[...Se.files??[]]},onFocus:_,onBlur:u},we,xe),null),a("div",{class:Ie},[!!((ne=v.value)!=null&&ne.length)&&!e.hideInput&&(d.selection?d.selection({fileNames:L.value,totalBytes:F.value,totalBytesReadable:h.value}):e.chips?L.value.map(z=>a(X,{key:z,size:"small",text:z},null)):L.value.join(", "))])])}})},details:c?U=>{var N,R;return a(T,null,[(N=d.details)==null?void 0:N.call(d,U),i&&a(T,null,[a("span",null,null),a(sa,{active:!!((R=v.value)!=null&&R.length),value:j.value,disabled:e.disabled},d.counter)])])}:void 0})}),ra({},S,D,b)}}),Fa={class:"ma-2 d-flex justify-space-between"},Da={class:"w-full d-flex justify-end mt-4"},Ba={key:0,class:"mt-2"},Za={__name:"index",setup(e){const s=ce(),r=be(),o=p(null),d=p(!1),g=p(null),v=p({}),V=p(!1),m=p(null),u=p(!1),f=[{title:"ID",key:"id"},{title:"Loan ID",key:"loan_id"},{title:"Mijoz",key:"client_name"},{title:"Qoldiq",key:"overdue_balance"},{title:"Local Code",key:"local_code"},{title:"Agentlar",key:"loan_agents"}],F=C(()=>!m.value||!m.value.data?[]:u.value?m.value.data:m.value.data.slice(0,10));async function h(){await r.fetchLoanPortfolio()}function L(x){return x?Number(x).toLocaleString("uz-UZ"):"0"}function j(){r.pageParams.page=1,h()}const S=p(!1);async function D(){if(!g.value||!o.value){s.error("Sana va faylni kiritish shart!");return}S.value=!0;try{let x="";o.value instanceof Date?x=o.value.toISOString().slice(0,10):x=String(o.value);const l=new FormData;l.append("file",g.value);const _=await _a(l,x);if(_.result==="Ok")v.value=_.data,m.value=_.data.invalid_loans||null,V.value=!0;else{s.error(_.message||"Faylni yuklashda xatolik yuz berdi");return}s.success("Fayl muvaffaqiyatli yuklandi"),d.value=!1,await h()}catch{s.error("Faylni yuklashda xatolik yuz berdi")}finally{S.value=!1}}p(null);let b=null;return Ve(()=>r.pageParams.query,(x,l)=>{clearTimeout(b),b=setTimeout(()=>{r.pageParams.page=1,h()},600)}),ca(()=>{h(),r.fetchAgents()}),(x,l)=>{const _=fa("VDateInput");return P(),$(Y,null,{default:n(()=>[a(ga,{class:"ma-2"},{default:n(()=>[a(K,{cols:"12",md:"3"},{default:n(()=>[a(Q,{class:"d-flex align-center pe-2"},{default:n(()=>l[13]||(l[13]=[y(" Kredit portfeli ")])),_:1})]),_:1}),a(K,{class:"d-flex",cols:"12",md:"3"},{default:n(()=>[a(ke,{modelValue:k(r).pageParams.loan_agent_id,"onUpdate:modelValue":[l[0]||(l[0]=t=>k(r).pageParams.loan_agent_id=t),h],items:k(r).agentsList,clearable:"","item-title":"full_name","item-value":"loan_agent_id",label:"Agent"},null,8,["modelValue","items"])]),_:1}),a(K,{class:"d-flex",cols:"12",md:"3"},{default:n(()=>[a(ee,{modelValue:k(r).pageParams.query,"onUpdate:modelValue":l[1]||(l[1]=t=>k(r).pageParams.query=t),clearable:"",density:"compact","hide-details":"",label:"Mijoz F.I.SH","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),a(K,{class:"d-flex justify-end",cols:"12",md:"3"},{default:n(()=>[a(w,{onClick:l[2]||(l[2]=t=>d.value=!0)},{default:n(()=>[a(ye,{class:"mr-1",icon:"mdi-file-excel",size:"25"}),l[14]||(l[14]=y(" yuklash "))]),_:1})]),_:1})]),_:1}),a(O,null,{default:n(()=>[a(ya,{headers:k(r).headers,items:k(r).loanPortfolioList,loading:k(r).loading,"fixed-header":"",height:"65vh","hide-default-footer":"","loading-text":"ma'lumotlar yuklanmoqda","no-data-text":"ma'lumot topilmadi"},{"item.overdue_balance":n(({item:t})=>[y(A(L(t.overdue_balance)),1)]),"item.loan_agents":n(({item:t})=>[(P(!0),M(T,null,re(t.loan_agents,B=>(P(),M("div",{key:B.loan_agent_id},A(B.full_name),1))),128))]),"item.actions":n(({item:t})=>[a(Ia,{"updating-item":t},null,8,["updating-item"])]),_:1},8,["headers","items","loading"]),a(ue,{class:"w-full d-flex justify-space-between mt-2"},{default:n(()=>[a(ka,{modelValue:k(r).pageParams.size,"onUpdate:modelValue":[l[3]||(l[3]=t=>k(r).pageParams.size=t),j],items:[10,20,50],label:"Har bir sahifa","max-width":"150"},null,8,["modelValue"]),a(pa,{modelValue:k(r).pageParams.page,"onUpdate:modelValue":[l[4]||(l[4]=t=>k(r).pageParams.page=t),h],length:k(r).pageLength,"total-visible":4,rounded:"circle"},null,8,["modelValue","length"])]),_:1})]),_:1}),a(ae,{modelValue:d.value,"onUpdate:modelValue":l[8]||(l[8]=t=>d.value=t),"max-width":"600px"},{default:n(()=>[a(Y,null,{default:n(()=>[I("div",Fa,[a(Q,{class:"text-h5"},{default:n(()=>l[15]||(l[15]=[y(" Kredit portfeli ")])),_:1}),a(w,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:l[5]||(l[5]=t=>d.value=!1)})]),a(O,null,{default:n(()=>[a(Aa,{modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=t=>g.value=t),accept:".xlsx, .xls, .csv",label:"Excel faylni tanlang",variant:"outlined"},null,8,["modelValue"]),a(_,{modelValue:o.value,"onUpdate:modelValue":l[7]||(l[7]=t=>o.value=t),label:"Sanani kiriting",variant:"outlined","prepend-icon":"mdi-calendar",class:"mt-4"},null,8,["modelValue"]),l[17]||(l[17]=I("div",{class:"mt-2"},[I("span",{class:"text-caption text-secondary"},[y(" Excel faylni yuklash uchun shartlar: "),I("ul",null,[I("li",null,"Faylning kengaytmasi .xlsx, .xls yoki .csv bo'lishi kerak."),I("li",null,"Faylda mijozlar haqida to'liq ma'lumot bo'lishi zarur.")])])],-1)),I("div",Da,[a(w,{disabled:!g.value,loading:S.value,onClick:D},{default:n(()=>l[16]||(l[16]=[y(" Yuklash ")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ae,{modelValue:V.value,"onUpdate:modelValue":l[12]||(l[12]=t=>V.value=t),"max-width":"1200px",persistent:""},{default:n(()=>[a(Y,null,{default:n(()=>[a(Q,{class:"d-flex align-center justify-space-between"},{default:n(()=>[l[18]||(l[18]=I("span",{class:"text-h6 font-weight-medium"},"Kredit Mijozlari Ro'yxati",-1)),a(w,{icon:"mdi-close",variant:"text",onClick:l[9]||(l[9]=t=>V.value=!1)})]),_:1}),a(J),m.value&&m.value.data&&m.value.data.length?(P(),$(O,{key:0},{default:n(()=>[a(de,{type:"warning",border:"start",variant:"tonal",class:"mb-4"},{default:n(()=>[y(A(m.value.message),1)]),_:1}),(P(!0),M(T,null,re(F.value,t=>(P(),$(X,{key:t,color:"error",size:"small",class:"ma-1"},{default:n(()=>[y(A(t),1)]),_:2},1024))),128)),m.value.data.length>10?(P(),M("div",Ba,[a(w,{size:"small",variant:"text",onClick:l[10]||(l[10]=t=>u.value=!u.value)},{default:n(()=>[y(A(u.value?"Yopish":"Hammasini ko‘rish"),1)]),_:1})])):G("",!0)]),_:1})):G("",!0),m.value&&m.value.data&&m.value.data.length?(P(),$(J,{key:1})):G("",!0),a(O,null,{default:n(()=>[a(de,{type:"warning",border:"start",variant:"tonal",class:"mb-4"},{default:n(()=>[y(A(v.value.message),1)]),_:1}),a(Va,{headers:f,items:v.value.data,class:"elevation-1 rounded-xl",density:"compact","fixed-header":"",height:"400"},{"item.loan_agents":n(({item:t})=>[t.loan_agents.length===0?(P(),$(X,{key:0,color:"error",size:"small",variant:"tonal"},{default:n(()=>l[19]||(l[19]=[y(" Taqsimlanmagan ")])),_:1})):(P(),$(X,{key:1,color:"success",size:"small",variant:"tonal"},{default:n(()=>[y(A(t.loan_agents.join(", ")),1)]),_:2},1024))]),_:1},8,["items"])]),_:1}),a(J),a(ue,null,{default:n(()=>[a(ma),a(w,{color:"primary",variant:"tonal",onClick:l[11]||(l[11]=t=>V.value=!1)},{default:n(()=>l[20]||(l[20]=[y(" Yopish ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Za as default};
