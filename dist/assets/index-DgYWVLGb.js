import{aD as we,r as y,aE as de,o as C,c as E,b as a,e as o,s as p,a3 as I,d as S,a2 as ze,aF as G,m as k,F as T,aS as Le,a8 as ce,ad as Fe,a9 as Ae,aT as De,aw as $e,ax as Be,ae as Te,aU as je,af as Ue,aa as Re,ag as qe,aV as Me,ab as me,aW as fe,X as h,aA as Ee,aX as Ne,aY as Oe,ay as He,az as Ke,an as Ye,aZ as Xe,aj as Ze,al as Qe,Y as We,ak as ve,a_ as Ge,$ as ge,aL as te,p as Y,a$ as Je,aB as pe,b0 as ea,b1 as aa,b2 as ne,w as ye,ac as la,b3 as ta,b4 as oe,b5 as na,b6 as oa,b7 as ia,b8 as sa,au as ua,b9 as ra,D as da,f as B,t as A,h as ie,x as W,V as ca,a as ma}from"./index-CkcxXxdr.js";import{a as fa,g as va,b as ga,u as pa}from"./loanPortfolioService-DNq9E9ax.js";import{V as X,b as Z,d as se,c as H}from"./VCard-Cx676qcg.js";import{V as ya}from"./VForm-DxV_xTaH.js";import{V as Ve}from"./VAutocomplete-Cd7t__Ox.js";import{V as J}from"./VDialog-CYqvF-Aj.js";import{a as K,V as Va}from"./VRow-B_WkQqw9.js";import{V as ka,a as ba,b as xa}from"./VDataTableVirtual-0R5T0ASY.js";import{V as Pa}from"./filter-Lx5_0yK4.js";import{V as Q}from"./VChip-1rQ_z4f2.js";import{V as ue}from"./VDivider-xt3MMd93.js";import"./axios-IRQqdfb-.js";import"./VAvatar-DBnLulyv.js";import"./VImg-DxCS7Hnw.js";import"./VList-CvdjHwQt.js";const ke=we("loanPortfolio",{state:()=>({headers:[{title:"Id",align:"start",key:"id",sortable:!1},{title:"Mijoz F.I.SH",align:"start",key:"client_name"},{title:"Muddati o'tgan qarz miqdori",align:"start",key:"overdue_balance"},{title:"Kredit id",align:"start",key:"loan_id"},{title:"Agent F.I.SH",align:"start",key:"loan_agents"},{title:"Lokal kod",align:"start",key:"local_code"},{title:"...",align:"center",key:"actions"}],pageParams:{page:1,size:50,loan_agent_id:null,query:null},pageLength:1,loanPortfolioList:[],loading:!1,agentsList:[]}),actions:{async fetchLoanPortfolio(){this.loading=!0;try{const e=await fa(this.pageParams);this.pageLength=(e==null?void 0:e.pages)||1,this.loanPortfolioList=e==null?void 0:e.items}catch(e){console.error("Error fetching loan portfolio:",e)}finally{this.loading=!1}},async fetchAgents(){this.loading=!0;try{this.agentsList=await va()}catch(e){console.error("Error fetching loan portfolio:",e)}}}}),_a={class:"ma-2 d-flex justify-space-between"},Ca={class:"w-full d-flex justify-end mt-4"},ha={__name:"AppendPortfolio",props:{updatingItem:Object},setup(e){const c=e,u=ke(),n=y(null),r=y(!1),g=y(null),f=de();async function V(){const{valid:m}=await g.value.validate();if(!m)return;r.value=!0;const s={loan_id:c.updatingItem.loan_id,loan_agent_id:c.updatingItem.loan_agent_id},v=await ga(s);r.value=!1,v.result==="Ok"&&(n.value=!1,await u.fetchLoanPortfolio(),f.success("Muvofaqqiyatli yangilandi."))}return(m,s)=>(C(),E(T,null,[a(I,{class:"ml-2",color:"primary",onClick:s[0]||(s[0]=v=>n.value=!0)},{default:o(()=>s[6]||(s[6]=[p(" Biriktirish ")])),_:1}),a(J,{modelValue:n.value,"onUpdate:modelValue":s[5]||(s[5]=v=>n.value=v),"max-width":"600px"},{default:o(()=>[a(X,null,{default:o(()=>[S("div",_a,[a(Z,{class:"text-h5"},{default:o(()=>s[7]||(s[7]=[p(" Kredit portfelini biriktirish ")])),_:1}),a(I,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:s[1]||(s[1]=v=>n.value=!1)})]),a(ya,{ref_key:"form",ref:g,class:"pa-6",onSubmit:ze(V,["prevent"])},{default:o(()=>[a(G,{modelValue:c.updatingItem.client_name,"onUpdate:modelValue":s[2]||(s[2]=v=>c.updatingItem.client_name=v),label:"Mijoz F.I.SH",readonly:""},null,8,["modelValue"]),a(G,{modelValue:c.updatingItem.loan_id,"onUpdate:modelValue":s[3]||(s[3]=v=>c.updatingItem.loan_id=v),class:"mt-4",label:"Kredit ID",readonly:""},null,8,["modelValue"]),a(Ve,{modelValue:c.updatingItem.loan_agent_id,"onUpdate:modelValue":s[4]||(s[4]=v=>c.updatingItem.loan_agent_id=v),items:k(u).agentsList,class:"mt-4","item-title":"full_name","item-value":"loan_agent_id",label:"Agent",clearable:""},null,8,["modelValue","items"]),S("div",Ca,[a(I,{loading:r.value,type:"submit"},{default:o(()=>s[8]||(s[8]=[p(" saqlash ")])),_:1},8,["loading"])])]),_:1},512)]),_:1})]),_:1},8,["modelValue"])],64))}},Sa=Le("v-alert-title"),Ia=["success","info","warning","error"],wa=ce({border:{type:[Boolean,String],validator:e=>typeof e=="boolean"||["top","end","bottom","start"].includes(e)},borderColor:String,closable:Boolean,closeIcon:{type:Fe,default:"$close"},closeLabel:{type:String,default:"$vuetify.close"},icon:{type:[Boolean,String,Function,Object],default:null},modelValue:{type:Boolean,default:!0},prominent:Boolean,title:String,text:String,type:{type:String,validator:e=>Ia.includes(e)},...Ae(),...De(),...$e(),...Be(),...Te(),...je(),...Ue(),...Re(),...qe(),...Me({variant:"flat"})},"VAlert"),re=me()({name:"VAlert",props:wa(),emits:{"click:close":e=>!0,"update:modelValue":e=>!0},setup(e,c){let{emit:u,slots:n}=c;const r=fe(e,"modelValue"),g=h(()=>{if(e.icon!==!1)return e.type?e.icon??`$${e.type}`:e.icon}),f=h(()=>({color:e.color??e.type,variant:e.variant})),{themeClasses:V}=Ee(e),{colorClasses:m,colorStyles:s,variantClasses:v}=Ne(f),{densityClasses:D}=Oe(e),{dimensionStyles:_}=He(e),{elevationClasses:F}=Ke(e),{locationStyles:j}=Ye(e),{positionClasses:w}=Xe(e),{roundedClasses:$}=Ze(e),{textColorClasses:b,textColorStyles:x}=Qe(We(e,"borderColor")),{t:l}=ve(),P=h(()=>({"aria-label":l(e.closeLabel),onClick(t){r.value=!1,u("click:close",t)}}));return()=>{const t=!!(n.prepend||g.value),z=!!(n.title||e.title),U=!!(n.close||e.closable);return r.value&&a(e.tag,{class:["v-alert",e.border&&{"v-alert--border":!!e.border,[`v-alert--border-${e.border===!0?"start":e.border}`]:!0},{"v-alert--prominent":e.prominent},V.value,m.value,D.value,F.value,w.value,$.value,v.value,e.class],style:[s.value,_.value,j.value,e.style],role:"alert"},{default:()=>{var N,i;return[Ge(!1,"v-alert"),e.border&&a("div",{key:"border",class:["v-alert__border",b.value],style:x.value},null),t&&a("div",{key:"prepend",class:"v-alert__prepend"},[n.prepend?a(te,{key:"prepend-defaults",disabled:!g.value,defaults:{VIcon:{density:e.density,icon:g.value,size:e.prominent?44:28}}},n.prepend):a(ge,{key:"prepend-icon",density:e.density,icon:g.value,size:e.prominent?44:28},null)]),a("div",{class:"v-alert__content"},[z&&a(Sa,{key:"title"},{default:()=>{var d;return[((d=n.title)==null?void 0:d.call(n))??e.title]}}),((N=n.text)==null?void 0:N.call(n))??e.text,(i=n.default)==null?void 0:i.call(n)]),n.append&&a("div",{key:"append",class:"v-alert__append"},[n.append()]),U&&a("div",{key:"close",class:"v-alert__close"},[n.close?a(te,{key:"close-defaults",defaults:{VBtn:{icon:e.closeIcon,size:"x-small",variant:"text"}}},{default:()=>{var d;return[(d=n.close)==null?void 0:d.call(n,{props:P.value})]}}):a(I,Y({key:"close-btn",icon:e.closeIcon,size:"x-small",variant:"text"},P.value),null)])]}})}}}),za=ce({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...Je({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>pe(e).every(c=>c!=null&&typeof c=="object")},...ea({clearable:!0})},"VFileInput"),La=me()({name:"VFileInput",inheritAttrs:!1,props:za(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,c){let{attrs:u,emit:n,slots:r}=c;const{t:g}=ve(),f=fe(e,"modelValue",e.modelValue,i=>pe(i),i=>!e.multiple&&Array.isArray(i)?i[0]:i),{isFocused:V,focus:m,blur:s}=aa(e),v=h(()=>typeof e.showSize!="boolean"?e.showSize:void 0),D=h(()=>(f.value??[]).reduce((i,d)=>{let{size:R=0}=d;return i+R},0)),_=h(()=>ne(D.value,v.value)),F=h(()=>(f.value??[]).map(i=>{const{name:d="",size:R=0}=i;return e.showSize?`${d} (${ne(R,v.value)})`:d})),j=h(()=>{var d;const i=((d=f.value)==null?void 0:d.length)??0;return e.showSize?g(e.counterSizeString,i,_.value):g(e.counterString,i)}),w=y(),$=y(),b=y(),x=h(()=>V.value||e.active),l=h(()=>["plain","underlined"].includes(e.variant));function P(){var i;b.value!==document.activeElement&&((i=b.value)==null||i.focus()),V.value||m()}function t(i){var d;(d=b.value)==null||d.click()}function z(i){n("mousedown:control",i)}function U(i){var d;(d=b.value)==null||d.click(),n("click:control",i)}function N(i){i.stopPropagation(),P(),ua(()=>{f.value=[],ra(e["onClick:clear"],i)})}return ye(f,i=>{(!Array.isArray(i)||!i.length)&&b.value&&(b.value.value="")}),la(()=>{const i=!!(r.counter||e.counter),d=!!(i||r.details),[R,be]=ta(u),{modelValue:$a,...xe}=oe.filterProps(e),Pe=na(e);return a(oe,Y({ref:w,modelValue:f.value,"onUpdate:modelValue":q=>f.value=q,class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":l.value},e.class],style:e.style,"onClick:prepend":t},R,xe,{centerAffix:!l.value,focused:V.value}),{...r,default:q=>{let{id:O,isDisabled:M,isDirty:ee,isReadonly:ae,isValid:_e}=q;return a(oa,Y({ref:$,"prepend-icon":e.prependIcon,onMousedown:z,onClick:U,"onClick:clear":N,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},Pe,{id:O.value,active:x.value||ee.value,dirty:ee.value||e.dirty,disabled:M.value,focused:V.value,error:_e.value===!1}),{...r,default:Ce=>{var le;let{props:{class:he,...Se}}=Ce;return a(T,null,[a("input",Y({ref:b,type:"file",readonly:ae.value,disabled:M.value,multiple:e.multiple,name:e.name,onClick:L=>{L.stopPropagation(),ae.value&&L.preventDefault(),P()},onChange:L=>{if(!L.target)return;const Ie=L.target;f.value=[...Ie.files??[]]},onFocus:P,onBlur:s},Se,be),null),a("div",{class:he},[!!((le=f.value)!=null&&le.length)&&!e.hideInput&&(r.selection?r.selection({fileNames:F.value,totalBytes:D.value,totalBytesReadable:_.value}):e.chips?F.value.map(L=>a(Q,{key:L,size:"small",text:L},null)):F.value.join(", "))])])}})},details:d?q=>{var O,M;return a(T,null,[(O=r.details)==null?void 0:O.call(r,q),i&&a(T,null,[a("span",null,null),a(ia,{active:!!((M=f.value)!=null&&M.length),value:j.value,disabled:e.disabled},r.counter)])])}:void 0})}),sa({},w,$,b)}}),Fa={class:"ma-2 d-flex justify-space-between"},Aa={class:"w-full d-flex justify-end mt-4"},Da={key:0,class:"mt-2"},Qa={__name:"index",setup(e){const c=de(),u=ke(),n=y(null),r=y(!1),g=y(null),f=y({}),V=y(!1),m=y(null),s=y(!1),v=[{title:"ID",key:"id"},{title:"Loan ID",key:"loan_id"},{title:"Mijoz",key:"client_name"},{title:"Qoldiq",key:"overdue_balance"},{title:"Local Code",key:"local_code"},{title:"Agentlar",key:"loan_agents"}],D=h(()=>!m.value||!m.value.data?[]:s.value?m.value.data:m.value.data.slice(0,10));async function _(){await u.fetchLoanPortfolio()}function F(x){return x?Number(x).toLocaleString("uz-UZ"):"0"}function j(){u.pageParams.page=1,_()}const w=y(!1);async function $(){if(!g.value||!n.value){c.error("Sana va faylni kiritish shart!");return}w.value=!0;try{let x="";if(n.value instanceof Date){const t=n.value.getFullYear(),z=String(n.value.getMonth()+1).padStart(2,"0"),U=String(n.value.getDate()).padStart(2,"0");x=`${t}-${z}-${U}`}else x=String(n.value);const l=new FormData;l.append("file",g.value);const P=await pa(l,x);P.result==="Ok"?(f.value=P.data,m.value=P.data.invalid_loans||null,V.value=!0,c.success("Fayl muvaffaqiyatli yuklandi"),r.value=!1,await _()):c.error(P.message||"Faylni yuklashda xatolik yuz berdi")}catch{c.error("Faylni yuklashda xatolik yuz berdi")}finally{w.value=!1,g.value=null,n.value=null}}y(null);let b=null;return ye(()=>u.pageParams.query,(x,l)=>{clearTimeout(b),b=setTimeout(()=>{u.pageParams.page=1,_()},600)}),da(()=>{_(),u.fetchAgents()}),(x,l)=>{const P=ma("VDateInput");return C(),B(X,null,{default:o(()=>[a(Va,{class:"ma-2"},{default:o(()=>[a(K,{cols:"12",md:"3"},{default:o(()=>[a(Z,{class:"d-flex align-center pe-2"},{default:o(()=>l[13]||(l[13]=[p(" Kredit portfeli ")])),_:1})]),_:1}),a(K,{class:"d-flex",cols:"12",md:"3"},{default:o(()=>[a(Ve,{modelValue:k(u).pageParams.loan_agent_id,"onUpdate:modelValue":[l[0]||(l[0]=t=>k(u).pageParams.loan_agent_id=t),_],items:k(u).agentsList,clearable:"","item-title":"full_name","item-value":"loan_agent_id",label:"Agent"},null,8,["modelValue","items"])]),_:1}),a(K,{class:"d-flex",cols:"12",md:"3"},{default:o(()=>[a(G,{modelValue:k(u).pageParams.query,"onUpdate:modelValue":l[1]||(l[1]=t=>k(u).pageParams.query=t),clearable:"",density:"compact","hide-details":"",label:"Mijoz F.I.SH","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"])]),_:1}),a(K,{class:"d-flex justify-end",cols:"12",md:"3"},{default:o(()=>[a(I,{onClick:l[2]||(l[2]=t=>r.value=!0)},{default:o(()=>[a(ge,{class:"mr-1",icon:"mdi-file-excel",size:"25"}),l[14]||(l[14]=p(" yuklash "))]),_:1})]),_:1})]),_:1}),a(H,null,{default:o(()=>[a(ka,{headers:k(u).headers,items:k(u).loanPortfolioList,loading:k(u).loading,"fixed-header":"",height:"65vh","hide-default-footer":"","loading-text":"ma'lumotlar yuklanmoqda","no-data-text":"ma'lumot topilmadi"},{"item.overdue_balance":o(({item:t})=>[p(A(F(t.overdue_balance)),1)]),"item.loan_agents":o(({item:t})=>[(C(!0),E(T,null,ie(t.loan_agents,z=>(C(),E("div",{key:z.loan_agent_id},A(z.full_name),1))),128))]),"item.actions":o(({item:t})=>[a(ha,{"updating-item":t},null,8,["updating-item"])]),_:1},8,["headers","items","loading"]),a(se,{class:"w-full d-flex justify-space-between mt-2"},{default:o(()=>[a(Pa,{modelValue:k(u).pageParams.size,"onUpdate:modelValue":[l[3]||(l[3]=t=>k(u).pageParams.size=t),j],items:[10,20,50],label:"Har bir sahifa","max-width":"150"},null,8,["modelValue"]),a(ba,{modelValue:k(u).pageParams.page,"onUpdate:modelValue":[l[4]||(l[4]=t=>k(u).pageParams.page=t),_],length:k(u).pageLength,"total-visible":4,rounded:"circle"},null,8,["modelValue","length"])]),_:1})]),_:1}),a(J,{modelValue:r.value,"onUpdate:modelValue":l[8]||(l[8]=t=>r.value=t),"max-width":"600px"},{default:o(()=>[a(X,null,{default:o(()=>[S("div",Fa,[a(Z,{class:"text-h5"},{default:o(()=>l[15]||(l[15]=[p(" Kredit portfeli ")])),_:1}),a(I,{color:"error",icon:"mdi-close",size:"large",variant:"text",onClick:l[5]||(l[5]=t=>r.value=!1)})]),a(H,null,{default:o(()=>[a(La,{modelValue:g.value,"onUpdate:modelValue":l[6]||(l[6]=t=>g.value=t),accept:".xlsx, .xls, .csv",label:"Excel faylni tanlang",variant:"outlined"},null,8,["modelValue"]),a(P,{modelValue:n.value,"onUpdate:modelValue":l[7]||(l[7]=t=>n.value=t),label:"Sanani kiriting",variant:"outlined","prepend-icon":"mdi-calendar",class:"mt-4"},null,8,["modelValue"]),l[17]||(l[17]=S("div",{class:"mt-2"},[S("span",{class:"text-caption text-secondary"},[p(" Excel faylni yuklash uchun shartlar: "),S("ul",null,[S("li",null,"Faylning kengaytmasi .xlsx, .xls yoki .csv bo'lishi kerak."),S("li",null,"Faylda mijozlar haqida to'liq ma'lumot bo'lishi zarur.")])])],-1)),S("div",Aa,[a(I,{disabled:!g.value,loading:w.value,onClick:$},{default:o(()=>l[16]||(l[16]=[p(" Yuklash ")])),_:1},8,["disabled","loading"])])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(J,{modelValue:V.value,"onUpdate:modelValue":l[12]||(l[12]=t=>V.value=t),"max-width":"1200px",persistent:""},{default:o(()=>[a(X,null,{default:o(()=>[a(Z,{class:"d-flex align-center justify-space-between"},{default:o(()=>[l[18]||(l[18]=S("span",{class:"text-h6 font-weight-medium"},"Kredit Mijozlari Ro'yxati",-1)),a(I,{icon:"mdi-close",variant:"text",onClick:l[9]||(l[9]=t=>V.value=!1)})]),_:1}),a(ue),m.value&&m.value.data&&m.value.data.length?(C(),B(H,{key:0},{default:o(()=>[a(re,{type:"warning",border:"start",variant:"tonal",class:"mb-4"},{default:o(()=>[p(A(m.value.message),1)]),_:1}),(C(!0),E(T,null,ie(D.value,t=>(C(),B(Q,{key:t,color:"error",size:"small",class:"ma-1"},{default:o(()=>[p(A(t),1)]),_:2},1024))),128)),m.value.data.length>10?(C(),E("div",Da,[a(I,{size:"small",variant:"text",onClick:l[10]||(l[10]=t=>s.value=!s.value)},{default:o(()=>[p(A(s.value?"Yopish":"Hammasini koâ€˜rish"),1)]),_:1})])):W("",!0)]),_:1})):W("",!0),m.value&&m.value.data&&m.value.data.length?(C(),B(ue,{key:1})):W("",!0),a(H,null,{default:o(()=>[a(re,{type:"warning",border:"start",variant:"tonal",class:"mb-4"},{default:o(()=>[p(A(f.value.message),1)]),_:1}),a(xa,{headers:v,items:f.value.data,class:"elevation-1 rounded-xl",density:"compact","fixed-header":"",height:"400"},{"item.loan_agents":o(({item:t})=>[t.loan_agents.length===0?(C(),B(Q,{key:0,color:"error",size:"small",variant:"tonal"},{default:o(()=>l[19]||(l[19]=[p(" Taqsimlanmagan ")])),_:1})):(C(),B(Q,{key:1,color:"success",size:"small",variant:"tonal"},{default:o(()=>[p(A(t.loan_agents.join(", ")),1)]),_:2},1024))]),_:1},8,["items"])]),_:1}),a(se,null,{default:o(()=>[a(ca),a(I,{color:"primary",variant:"tonal",onClick:l[11]||(l[11]=t=>V.value=!1)},{default:o(()=>l[20]||(l[20]=[p(" Yopish ")])),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}}};export{Qa as default};
