import{aq as Z,ar as S,r as g,at as K,o as T,c as A,b as l,e as a,s as U,a3 as x,a2 as N,as as w,H as D,w as Y,D as G,a as ee,ci as J,bp as le,K as ae,p as te,F as ie,m as oe,t as X,d as P,V as ue}from"./index-ugE2diwG.js";import{a as ne,b as se,c as re,d as de,e as me,f as fe,h as pe}from"./userService-BwDeVRE7.js";import{g as ve}from"./regionService-C0wOXPfj.js";import"./axios-BhI_j3KQ.js";import{g as ce}from"./departmentService-BidbM0GW.js";import{c as M}from"./localCodeService-BNprE8y2.js";import{V as z,b as $,d as H}from"./VCard-SX4cXtR7.js";import{V as R}from"./VDivider-Bpjbs-Pq.js";import{V as E}from"./VForm-ChxjC397.js";import{V as I,a as k}from"./VRow-36agrQek.js";import{V as C}from"./VAutocomplete-Dm7y-anX.js";import{V as B}from"./VDialog-CIam9dbg.js";import{V as ge}from"./VDataTableVirtual-Bf3SGZG3.js";import{V as Ve}from"./VTooltip-DTL9M_bj.js";import"./VAvatar-B0HJojTh.js";import"./VImg-B0R5TV1H.js";import"./filter-BnwPlqYj.js";import"./VList-DuunN5-t.js";import"./VChip-BHX79YCc.js";const be=Z("user",{state:()=>({headers:[{title:"â„–",align:"start",key:"id",sortable:!1},{title:"Xodim F.I.SH",align:"start",key:"full_name"},{title:"Foydalanuvchi nomi (username/login)",align:"start",key:"username"},{title:"PINFL",align:"start",key:"pinfl"},{title:"Telefon",align:"start",key:"phone"},{title:"Lokal kod",align:"start",key:"local_code"},{title:"Departament",align:"start",key:"department"},{title:"Sozlamalar",align:"end",key:"actions",sortable:!1}]}),actions:{}}),ye={class:"text-center"},ke={__name:"CreateUser",props:{regionList:Array,departmentList:Array},emits:["created"],setup(f,{emit:y}){const r=y,n=S(),u=g({full_name:null,username:null,pinfl:null,phone:null,region_id:null,local_code_id:null,department_id:null,password:null}),d=g([]);async function o(){if(u.value.local_code_id=null,u.value.region_id){const q=await M(u.value.region_id);q.length&&(d.value=q)}else d.value=[]}const V=g(!1),m=g(null);async function p(){const{valid:q}=await m.value.validate();if(!q)return;(await ne(u.value)).status===201?(n.success("Muvofaqqiyatli yaratildi."),r("created"),m.value.reset(),V.value=!1):n.error("Xatolik yuz berdi!")}return(q,i)=>{const s=K("mask");return T(),A("div",ye,[l(x,{class:"ml-3",onClick:i[0]||(i[0]=e=>V.value=!0)},{default:a(()=>i[12]||(i[12]=[U(" qo'shish ")])),_:1}),l(B,{modelValue:V.value,"onUpdate:modelValue":i[11]||(i[11]=e=>V.value=e),"max-width":"900"},{default:a(()=>[l(z,{class:"pa-4"},{default:a(()=>[l($,null,{default:a(()=>i[13]||(i[13]=[U(" Yangi xodim qo'shish ")])),_:1}),l(R,{class:"mb-4"}),l(E,{ref_key:"form",ref:m,onSubmit:N(p,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[l(k,{cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:u.value.full_name,"onUpdate:modelValue":i[1]||(i[1]=e=>u.value.full_name=e),rules:[e=>!!e||"to'ldirish majburiy!",e=>e&&e.length>=3||"kamida 3 harfdan iborat bo'lishi zarur"],label:"Xodim F.I.SH",required:""},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[D(l(w,{modelValue:u.value.pinfl,"onUpdate:modelValue":i[2]||(i[2]=e=>u.value.pinfl=e),rules:[e=>!!e||"to'ldirish majburiy!",e=>e&&e.length>=14||"pinfl kamida 14 raqamdan iborat bo'lishi zarur"],label:"PINFL",required:""},null,8,["modelValue","rules"]),[[s,"##############"]])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:u.value.username,"onUpdate:modelValue":i[3]||(i[3]=e=>u.value.username=e),rules:[e=>!!e||"to'ldirish majburiy!",e=>e&&e.length>=3||"kamida 3 raqamdan iborat bo'lishi zarur"],label:"Foydalanuvchi nomi (login/username)",required:""},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:u.value.password,"onUpdate:modelValue":i[4]||(i[4]=e=>u.value.password=e),rules:[e=>!!e||"to'ldirish majburiy!",e=>e&&e.length>=3||" kamida 3 belgidan iborat bo'lishi zarur"],label:"Parol",required:""},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[D(l(w,{modelValue:u.value.phone,"onUpdate:modelValue":i[5]||(i[5]=e=>u.value.phone=e),rules:[e=>!!e||"to'ldirish majburiy!",e=>e&&e.length>=14||"telefon raqamni to'g'ri kiriting, (90) 123-45-67"],label:"Telefon",required:""},null,8,["modelValue","rules"]),[[s,"(##) ###-##-##"]])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:u.value.region_id,"onUpdate:modelValue":[i[6]||(i[6]=e=>u.value.region_id=e),i[7]||(i[7]=e=>o())],items:f.regionList,rules:[e=>!!e||"to'ldirish majburiy!"],clearable:"","item-title":"name_uz","item-value":"id",label:"Viloyat",required:""},null,8,["modelValue","items","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:u.value.local_code_id,"onUpdate:modelValue":i[8]||(i[8]=e=>u.value.local_code_id=e),items:d.value,rules:[e=>!!e||"to'ldirish majburiy!"],clearable:"","item-title":"name","item-value":"id",label:"Bank filiali",required:""},null,8,["modelValue","items","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:u.value.department_id,"onUpdate:modelValue":i[9]||(i[9]=e=>u.value.department_id=e),items:f.departmentList,clearable:"","item-title":"department_name","item-value":"id",label:"Departament"},null,8,["modelValue","items"])]),_:1})]),_:1}),l(H,{class:"d-flex w-full justify-end mt-4"},{default:a(()=>[l(x,{color:"error",variant:"elevated",onClick:i[10]||(i[10]=e=>V.value=!1)},{default:a(()=>i[14]||(i[14]=[U(" bekor qilish ")])),_:1}),l(x,{color:"success",type:"submit",variant:"elevated"},{default:a(()=>i[15]||(i[15]=[U(" saqlash ")])),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])])}}},_e={class:"text-center"},Ue={__name:"UpdateUser",props:{updatingItem:Object,regionList:Array,departmentList:Array,updateDialog:{type:Boolean,default:!1}},emits:["updated","update:updateDialog"],setup(f,{emit:y}){const r=f,n=y;function u(){n("update:updateDialog",!1)}const d=S(),o=g(),V=g(null);async function m(){var _;const{valid:s}=await V.value.validate();if(!s)return;o.value.local_code_id=o.value.local_code.id,o.value.department_id=(_=o.value.department)==null?void 0:_.id;const e=await se(r.updatingItem.id,o.value);(e==null?void 0:e.status)===200?(d.success("Muvofaqqiyatli yangilandi."),n("update:updateDialog",!1),n("updated"),V.value.reset()):d.error("Xatolik yuz berdi")}const p=g([]);async function q(){var s,e;(s=o.value.local_code)!=null&&s.region_id&&(p.value=await M((e=o.value.local_code)==null?void 0:e.region_id))}async function i(){o.value.local_code.id=null,o.value.local_code.region_id?p.value=await M(o.value.local_code.region_id):p.value=[]}return Y(()=>r.updateDialog,s=>{o.value={...r.updatingItem},q()}),(s,e)=>{const _=K("mask");return T(),A("div",_e,[l(B,{modelValue:r.updateDialog,"onUpdate:modelValue":e[9]||(e[9]=t=>r.updateDialog=t),"max-width":"900"},{default:a(()=>[l(z,{class:"pa-4"},{default:a(()=>[l($,null,{default:a(()=>e[10]||(e[10]=[U(" Xodim ma'lumotlarini o'zgartirish ")])),_:1}),l(R,{class:"mb-4"}),l(E,{ref_key:"form",ref:V,onSubmit:N(m,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[l(k,{cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:o.value.full_name,"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.full_name=t),rules:[t=>!!t||"to'ldirish majburiy!",t=>t&&t.length>=3||"kamida 3 harfdan iborat bo'lishi zarur"],label:"Xodim F.I.SH",required:""},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[D(l(w,{modelValue:o.value.pinfl,"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.pinfl=t),rules:[t=>!!t||"to'ldirish majburiy!",t=>t&&t.length>=14||"pinfl kamida 14 raqamdan iborat bo'lishi zarur"],label:"PINFL",required:""},null,8,["modelValue","rules"]),[[_,"##############"]])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:o.value.username,"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.username=t),rules:[t=>!!t||"to'ldirish majburiy!",t=>t&&t.length>=3||"kamida 3 raqamdan iborat bo'lishi zarur"],label:"Foydalanuvchi nomi (login/username)",required:""},null,8,["modelValue","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:o.value.password,"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.password=t),label:"Parol"},null,8,["modelValue"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[D(l(w,{modelValue:o.value.phone,"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.phone=t),rules:[t=>!!t||"to'ldirish majburiy!",t=>t&&t.length>=14||"telefon raqamni to'g'ri kiriting, (90) 123-45-67"],label:"Telefon",required:""},null,8,["modelValue","rules"]),[[_,"(##) ###-##-##"]])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:o.value.local_code.region_id,"onUpdate:modelValue":[e[5]||(e[5]=t=>o.value.local_code.region_id=t),e[6]||(e[6]=t=>i())],items:f.regionList,rules:[t=>!!t||"to'ldirish majburiy!"],clearable:"","item-title":"name_uz","item-value":"id",label:"Viloyat",required:""},null,8,["modelValue","items","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:o.value.local_code.id,"onUpdate:modelValue":e[7]||(e[7]=t=>o.value.local_code.id=t),items:p.value,rules:[t=>!!t||"to'ldirish majburiy!"],clearable:"","item-title":"name","item-value":"id",label:"Lokal kod",required:""},null,8,["modelValue","items","rules"])]),_:1}),l(k,{cols:"12",md:"6"},{default:a(()=>[l(C,{modelValue:o.value.department,"onUpdate:modelValue":e[8]||(e[8]=t=>o.value.department=t),items:f.departmentList,rules:[t=>!!t||"to'ldirish majburiy!"],clearable:"","item-title":"department_name",label:"Departament",required:"","return-object":""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),l(H,{class:"d-flex w-full justify-end mt-4"},{default:a(()=>[l(x,{color:"error",variant:"elevated",onClick:u},{default:a(()=>e[11]||(e[11]=[U(" bekor qilish ")])),_:1}),l(x,{color:"success",type:"submit",variant:"elevated"},{default:a(()=>e[12]||(e[12]=[U(" saqlash ")])),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])])}}},qe={class:"text-center"},xe={__name:"EditPermission",props:{updatingItem:Object,permissionDialog:{type:Boolean,default:!1}},emits:["updated","update:updateDialog"],setup(f,{emit:y}){const r=f,n=y;function u(){n("update:updateDialog",!1)}const d=S();g();const o=g(null),V=g(null);async function m(){V.value=await re()}const p=g([]);async function q(){var s;p.value=await de((s=r==null?void 0:r.updatingItem)==null?void 0:s.id)}async function i(){var t;const{valid:s}=await o.value.validate();if(!s)return;const e=p.value.map(j=>j.id),{result:_}=await me(e,(t=r==null?void 0:r.updatingItem)==null?void 0:t.id);_==="OK"?(d.success("Muvofaqqiyatli yangilandi."),n("update:updateDialog",!1)):d.error("Xatolik yuz berdi")}return G(()=>{m()}),Y(()=>r.permissionDialog,s=>{s===!0&&q()}),(s,e)=>(T(),A("div",qe,[l(B,{modelValue:r.permissionDialog,"onUpdate:modelValue":e[1]||(e[1]=_=>r.permissionDialog=_),"max-width":"900"},{default:a(()=>[l(z,{class:"pa-4"},{default:a(()=>[l($,null,{default:a(()=>e[2]||(e[2]=[U(" Xodim rollarini o'zgartirish ")])),_:1}),l(R,{class:"mb-4"}),l(E,{ref_key:"form",ref:o,onSubmit:N(i,["prevent"])},{default:a(()=>[l(I,null,{default:a(()=>[l(k,{cols:"12",md:"12"},{default:a(()=>[l(C,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=_=>p.value=_),items:V.value,rules:[_=>Array.isArray(_)&&_.length>0||"To'ldirish majburiy!"],"item-title":"name",label:"Xodim rollari",multiple:"","return-object":""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),l(H,{class:"d-flex w-full justify-end mt-4"},{default:a(()=>[l(x,{color:"error",variant:"elevated",onClick:u},{default:a(()=>e[3]||(e[3]=[U(" bekor qilish ")])),_:1}),l(x,{color:"success",type:"submit",variant:"elevated"},{default:a(()=>e[4]||(e[4]=[U(" saqlash ")])),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]))}};function we(f,y){const r=typeof f=="string"?ee(f):f,n=De(r,y);return{mounted:n,updated:n,unmounted(u){J(null,u)}}}function De(f,y){return function(r,n,u){var i,s,e;const d=typeof y=="function"?y(n):y,o=((i=n.value)==null?void 0:i.text)??n.value??(d==null?void 0:d.text),V=le(n.value)?n.value:{},m=()=>o??r.textContent,p=(u.ctx===n.instance.$?(s=Ce(u,n.instance.$))==null?void 0:s.provides:(e=u.ctx)==null?void 0:e.provides)??n.instance.$.provides,q=ae(f,te(d,V),m);q.appContext=Object.assign(Object.create(null),n.instance.$.appContext,{provides:p}),J(q,r)}}function Ce(f,y){const r=new Set,n=d=>{var o,V;for(const m of d){if(!m)continue;if(m===f||m.el&&f.el&&m.el===f.el)return!0;r.add(m);let p;if(m.suspense?p=n([m.ssContent]):Array.isArray(m.children)?p=n(m.children):(o=m.component)!=null&&o.vnode&&(p=n([(V=m.component)==null?void 0:V.subTree])),p)return p;r.delete(m)}return!1};if(!n([y.subTree]))return y;const u=Array.from(r).reverse();for(const d of u)if(d.component)return d.component;return y}const O=we(Ve,f=>{var y;return{activator:"parent",location:(y=f.arg)==null?void 0:y.replace("-"," "),text:typeof f.value=="boolean"?void 0:f.value}}),he={style:{"min-width":"180px"}},Ye={__name:"index",setup(f){const y=S(),r=be(),n=g(!1),u=g([]),d=g(null);async function o(){n.value=!0;const v=await fe();n.value=!1,v!=null&&v.length&&(u.value=v)}const V=g([]);async function m(){const v=await ve();v!=null&&v.length&&(V.value=v)}g([]);const p=g([]);async function q(){const v=await ce();v!=null&&v.length&&(p.value=v)}const i=g(!1),s=g(null),e=g(!1);function _(v){s.value=v,i.value=!0}async function t(){e.value=!0;const v=await pe(s.value.id);e.value=!1,v.status===200&&y.success("Muvofaqqiyatli o'chirildi"),i.value=!1,await o()}const j=g(!1);function Q(v){s.value=null,s.value=v,j.value=!0}const F=g(!1);function W(v){s.value=null,s.value=v,F.value=!0}return G(()=>{o(),m(),q()}),(v,c)=>(T(),A(ie,null,[l(Ue,{"update-dialog":j.value,"onUpdate:updateDialog":c[0]||(c[0]=b=>j.value=b),"department-list":p.value,"region-list":V.value,"updating-item":s.value,onUpdated:o},null,8,["update-dialog","department-list","region-list","updating-item"]),l(xe,{"update-dialog":F.value,"onUpdate:updateDialog":c[1]||(c[1]=b=>F.value=b),"permission-dialog":F.value,"updating-item":s.value},null,8,["update-dialog","permission-dialog","updating-item"]),l(z,{flat:""},{default:a(()=>[l(I,{class:"ma-2"},{default:a(()=>[l(k,{cols:"12",md:"6"},{default:a(()=>[l($,{class:"d-flex align-center pe-2"},{default:a(()=>c[7]||(c[7]=[U(" Xodimlar ro'yxati ")])),_:1})]),_:1}),l(k,{class:"d-flex",cols:"12",md:"6"},{default:a(()=>[l(w,{modelValue:d.value,"onUpdate:modelValue":c[2]||(c[2]=b=>d.value=b),clearable:"",density:"compact","hide-details":"",label:"qidirish...","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"]),l(ke,{"department-list":p.value,"region-list":V.value,onCreated:o},null,8,["department-list","region-list"])]),_:1})]),_:1}),l(R),l(ge,{search:d.value,"onUpdate:search":c[3]||(c[3]=b=>d.value=b),"filter-keys":["full_name","pinfl"],headers:oe(r).headers,items:u.value,loading:n.value,"fixed-header":"",height:"71vh","loading-text":"ma'lumotlar yuklanmoqda","no-data-text":"ma'lumot topilmadi"},{"item.id":a(({item:b,index:h})=>[U(X(h+1),1)]),"item.local_code":a(({item:b,index:h})=>{var L;return[P("div",null,X((L=b.local_code)==null?void 0:L.name),1)]}),"item.department":a(({item:b,index:h})=>{var L;return[P("div",null,X((L=b.department)==null?void 0:L.department_name),1)]}),"item.actions":a(({item:b})=>[P("div",he,[D(l(x,{color:"warning",density:"default",icon:"mdi-pencil-circle",size:"x-large",variant:"plain",onClick:h=>Q(b)},null,8,["onClick"]),[[O,"O'zgartirish","bottom-end"]]),D(l(x,{color:"error",density:"default",icon:"mdi-delete",size:"x-large",variant:"plain",onClick:h=>_(b)},null,8,["onClick"]),[[O,"O'chirish","bottom-end"]]),D(l(x,{color:"black",density:"default",icon:"mdi-lock-reset",size:"x-large",variant:"plain",onClick:h=>W(b)},null,8,["onClick"]),[[O,"Rollarni o'zgartirish","bottom-end"]])])]),_:1},8,["search","headers","items","loading"]),l(B,{modelValue:i.value,"onUpdate:modelValue":c[6]||(c[6]=b=>i.value=b),"max-width":"600",persistent:""},{default:a(()=>[l(z,{class:"pa-4"},{actions:a(()=>[l(ue),l(x,{color:"success",onClick:c[5]||(c[5]=b=>i.value=!1)},{default:a(()=>c[9]||(c[9]=[U(" Bekor qilish ")])),_:1}),l(x,{loading:e.value,color:"error",onClick:t},{default:a(()=>c[10]||(c[10]=[U(" Tasdiqlash ")])),_:1},8,["loading"])]),default:a(()=>[l($,{class:"text-center mb-4 font-weight-bold"},{default:a(()=>c[8]||(c[8]=[U(" Ushbu ma'lumotni o'chirishni tasdiqlaysizmi? ")])),_:1}),l(I,{class:"mb-4"},{default:a(()=>[l(k,{cols:"12",md:"12"},{default:a(()=>[l(w,{modelValue:s.value.full_name,"onUpdate:modelValue":c[4]||(c[4]=b=>s.value.full_name=b),label:"Xodim F.I.Sh",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})],64))}};export{Ye as default};
