import{aD as ee,a_ as z,r as V,aO as E,o as F,c as A,b as a,e as o,s as k,a3 as U,a2 as N,aW as h,H as q,w as W,D as Y,a as le,bm as G,bk as ae,K as te,p as oe,F as ie,m as ne,t as P,d as X,V as se}from"./index-C6ew0Dc-.js";import{a as ue,b as re,g as de,c as me,d as fe,e as pe,f as ce}from"./userService-QkqF3XRm.js";import{a as ve}from"./regionService-DizklQH1.js";import{a as J}from"./axios-DkIq-4yk.js";import{V as j,b as I,d as M}from"./VCard-h-Dk38gb.js";import{V as B}from"./VDivider-BHSlz9wh.js";import{V as H}from"./VForm-BcttrLW2.js";import{V as S,a as y}from"./VRow-DFEFfj3U.js";import{V as D}from"./VAutocomplete-DqYqFo1F.js";import{V as R}from"./filter-BBDhmrCb.js";import{V as ge}from"./VDataTableVirtual-CmELzhnE.js";import{V as Ve}from"./VTooltip-4pAptgvZ.js";import"./VAvatar-Bw4S9iN_.js";import"./VImg-B4OtRQkU.js";import"./VList-BcS13ebf.js";import"./VCheckboxBtn-D_HgVTnU.js";import"./VChip-B--6Bg9V.js";const ye=ee("user",{state:()=>({headers:[{title:"№",align:"start",key:"id",sortable:!1},{title:"Xodim F.I.SH",align:"start",key:"full_name"},{title:"Foydalanuvchi nomi (username/login)",align:"start",key:"username"},{title:"PINFL",align:"start",key:"pinfl"},{title:"Telefon",align:"start",key:"phone"},{title:"Lokal kod",align:"start",key:"local_code"},{title:"Departament",align:"start",key:"department"},{title:"Sozlamalar",align:"end",key:"actions",sortable:!1}]}),actions:{}});async function K(r){try{const{data:f}=await J.get("/v1/local-code/get-all",{params:{region_id:r}});return f}catch(f){return f}}async function be(){try{const{data:r}=await J.get("/v1/departments/get-all");return r}catch(r){return r}}const _e={class:"text-center"},ke={__name:"CreateUser",props:{regionList:Array,departmentList:Array},emits:["created"],setup(r,{emit:f}){const d=f,u=z(),s=V({full_name:null,username:null,pinfl:null,phone:null,region_id:null,local_code_ids:[],department_id:null,password:null}),p=V([]);async function b(){if(s.value.local_code_ids=[],s.value.region_id){const x=await K(s.value.region_id);p.value=x||[]}else p.value=[]}const i=V(!1),m=V(null);async function _(){const{valid:x}=await m.value.validate();if(!x)return;const n={...s.value,local_code_ids:s.value.local_code_ids};(await ue(n)).status===201?(u.success("Muvofaqqiyatli yaratildi."),d("created"),m.value.reset(),s.value.local_code_ids=[],i.value=!1):u.error("Xatolik yuz berdi!")}return(x,n)=>{const t=E("mask");return F(),A("div",_e,[a(U,{class:"ml-3",onClick:n[0]||(n[0]=e=>i.value=!0)},{default:o(()=>n[12]||(n[12]=[k(" qo'shish ")])),_:1}),a(R,{modelValue:i.value,"onUpdate:modelValue":n[11]||(n[11]=e=>i.value=e),"max-width":"900"},{default:o(()=>[a(j,{class:"pa-4"},{default:o(()=>[a(I,null,{default:o(()=>n[13]||(n[13]=[k("Yangi xodim qo'shish")])),_:1}),a(B,{class:"mb-4"}),a(H,{ref_key:"form",ref:m,onSubmit:N(_,["prevent"])},{default:o(()=>[a(S,null,{default:o(()=>[a(y,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:s.value.full_name,"onUpdate:modelValue":n[1]||(n[1]=e=>s.value.full_name=e),rules:[e=>!!e||"To‘ldirish majburiy!",e=>(e==null?void 0:e.length)>=3||"Kamida 3 harf bo‘lishi kerak"],label:"Xodim F.I.SH",required:""},null,8,["modelValue","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[q(a(h,{modelValue:s.value.pinfl,"onUpdate:modelValue":n[2]||(n[2]=e=>s.value.pinfl=e),rules:[e=>!!e||"To‘ldirish majburiy!",e=>(e==null?void 0:e.length)===14||"PINFL 14 raqamdan iborat bo‘lishi zarur"],label:"PINFL",required:""},null,8,["modelValue","rules"]),[[t,"##############"]])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:s.value.username,"onUpdate:modelValue":n[3]||(n[3]=e=>s.value.username=e),rules:[e=>!!e||"To‘ldirish majburiy!",e=>(e==null?void 0:e.length)>=3||"Kamida 3 belgi bo‘lishi kerak"],label:"Foydalanuvchi nomi (login)",required:""},null,8,["modelValue","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:s.value.password,"onUpdate:modelValue":n[4]||(n[4]=e=>s.value.password=e),rules:[e=>!!e||"To‘ldirish majburiy!",e=>(e==null?void 0:e.length)>=3||"Kamida 3 belgi bo‘lishi kerak"],label:"Parol",required:""},null,8,["modelValue","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[q(a(h,{modelValue:s.value.phone,"onUpdate:modelValue":n[5]||(n[5]=e=>s.value.phone=e),rules:[e=>!!e||"To‘ldirish majburiy!",e=>(e==null?void 0:e.length)>=14||"Telefon raqamni to‘g‘ri kiriting"],label:"Telefon",required:""},null,8,["modelValue","rules"]),[[t,"(##) ###-##-##"]])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(D,{modelValue:s.value.region_id,"onUpdate:modelValue":[n[6]||(n[6]=e=>s.value.region_id=e),n[7]||(n[7]=e=>b())],items:r.regionList,"item-title":"name_uz","item-value":"id",label:"Viloyat",clearable:"",required:"",rules:[e=>!!e||"To‘ldirish majburiy!"]},null,8,["modelValue","items","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(D,{modelValue:s.value.local_code_ids,"onUpdate:modelValue":n[8]||(n[8]=e=>s.value.local_code_ids=e),items:p.value,"item-title":"name","item-value":"id",label:"Bank filiali (bir nechta tanlash mumkin)",multiple:"",chips:"",clearable:"",rules:[e=>(e==null?void 0:e.length)>0||"Hech bo‘lmaganda 1 filial tanlang"],required:""},null,8,["modelValue","items","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(D,{modelValue:s.value.department_id,"onUpdate:modelValue":n[9]||(n[9]=e=>s.value.department_id=e),items:r.departmentList,"item-title":"department_name","item-value":"id",label:"Departament",clearable:""},null,8,["modelValue","items"])]),_:1})]),_:1}),a(M,{class:"d-flex justify-end mt-4"},{default:o(()=>[a(U,{color:"error",variant:"elevated",onClick:n[10]||(n[10]=e=>i.value=!1)},{default:o(()=>n[14]||(n[14]=[k("Bekor qilish")])),_:1}),a(U,{color:"success",type:"submit",variant:"elevated"},{default:o(()=>n[15]||(n[15]=[k("Saqlash")])),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])])}}},xe={class:"text-center"},Ue={__name:"UpdateUser",props:{updatingItem:Object,regionList:Array,departmentList:Array,updateDialog:{type:Boolean,default:!1}},emits:["updated","update:updateDialog"],setup(r,{emit:f}){const d=r,u=f;function s(){u("update:updateDialog",!1)}const p=z(),b=V(null),i=V({full_name:"",pinfl:"",username:"",password:"",phone:"",local_code_ids:[],region_id:null,department:null}),m=V([]);async function _(){i.value.local_code_ids=[],i.value.region_id?m.value=await K(i.value.region_id):m.value=[]}async function x(){var l;const{valid:n}=await b.value.validate();if(!n)return;const t={full_name:i.value.full_name,pinfl:i.value.pinfl,username:i.value.username,password:i.value.password,phone:i.value.phone,department_id:((l=i.value.department)==null?void 0:l.id)||null,region_id:i.value.region_id,local_code_ids:i.value.local_code_ids},e=await re(d.updatingItem.id,t);(e==null?void 0:e.status)===200?(p.success("Muvofaqqiyatli yangilandi."),u("update:updateDialog",!1),u("updated"),b.value.reset()):p.error("Xatolik yuz berdi")}return W(()=>d.updateDialog,async n=>{var t,e;if(n){const l=d.updatingItem;i.value={full_name:(l==null?void 0:l.full_name)||"",pinfl:(l==null?void 0:l.pinfl)||"",username:(l==null?void 0:l.username)||"",password:"",phone:(l==null?void 0:l.phone)||"",region_id:((t=l==null?void 0:l.local_code)==null?void 0:t.region_id)||null,department:(l==null?void 0:l.department)||null,local_code_ids:Array.isArray(l==null?void 0:l.local_code)?l.local_code.map(C=>C.id):(e=l==null?void 0:l.local_code)!=null&&e.id?[l.local_code.id]:[]},i.value.region_id&&(m.value=await K(i.value.region_id))}}),(n,t)=>{const e=E("mask");return F(),A("div",xe,[a(R,{modelValue:d.updateDialog,"onUpdate:modelValue":t[8]||(t[8]=l=>d.updateDialog=l),"max-width":"900"},{default:o(()=>[a(j,{class:"pa-4"},{default:o(()=>[a(I,null,{default:o(()=>t[9]||(t[9]=[k("Xodim ma'lumotlarini o'zgartirish")])),_:1}),a(B,{class:"mb-4"}),a(H,{ref_key:"form",ref:b,onSubmit:N(x,["prevent"])},{default:o(()=>[a(S,null,{default:o(()=>[a(y,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:i.value.full_name,"onUpdate:modelValue":t[0]||(t[0]=l=>i.value.full_name=l),label:"Xodim F.I.SH",required:"",rules:[l=>!!l||"To‘ldirish majburiy!",l=>l&&l.length>=3||"Kamida 3 harf bo‘lishi kerak"]},null,8,["modelValue","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[q(a(h,{modelValue:i.value.pinfl,"onUpdate:modelValue":t[1]||(t[1]=l=>i.value.pinfl=l),label:"PINFL",required:"",rules:[l=>!!l||"To‘ldirish majburiy!",l=>l&&l.length===14||"PINFL 14 raqamdan iborat bo‘lishi kerak"]},null,8,["modelValue","rules"]),[[e,"##############"]])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:i.value.username,"onUpdate:modelValue":t[2]||(t[2]=l=>i.value.username=l),label:"Login",required:"",rules:[l=>!!l||"To‘ldirish majburiy!",l=>l&&l.length>=3||"Kamida 3 belgidan iborat bo‘lishi kerak"]},null,8,["modelValue","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:i.value.password,"onUpdate:modelValue":t[3]||(t[3]=l=>i.value.password=l),label:"Parol"},null,8,["modelValue"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[q(a(h,{modelValue:i.value.phone,"onUpdate:modelValue":t[4]||(t[4]=l=>i.value.phone=l),label:"Telefon",required:"",rules:[l=>!!l||"To‘ldirish majburiy!",l=>l&&l.length>=14||"Telefon raqam to‘g‘ri emas"]},null,8,["modelValue","rules"]),[[e,"(##) ###-##-##"]])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(D,{modelValue:i.value.region_id,"onUpdate:modelValue":[t[5]||(t[5]=l=>i.value.region_id=l),_],items:r.regionList,"item-title":"name_uz","item-value":"id",label:"Viloyat",clearable:"",required:"",rules:[l=>!!l||"To‘ldirish majburiy!"]},null,8,["modelValue","items","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(D,{modelValue:i.value.local_code_ids,"onUpdate:modelValue":t[6]||(t[6]=l=>i.value.local_code_ids=l),items:m.value,"item-title":"name","item-value":"id",label:"Lokal kod(lar)",multiple:"",chips:"",clearable:"",required:"",rules:[l=>l&&l.length>0||"Kamida 1 ta tanlanishi kerak"]},null,8,["modelValue","items","rules"])]),_:1}),a(y,{cols:"12",md:"6"},{default:o(()=>[a(D,{modelValue:i.value.department,"onUpdate:modelValue":t[7]||(t[7]=l=>i.value.department=l),items:r.departmentList,"item-title":"department_name",label:"Departament",clearable:"",required:"","return-object":"",rules:[l=>!!l||"To‘ldirish majburiy!"]},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),a(M,{class:"d-flex justify-end mt-4"},{default:o(()=>[a(U,{color:"error",onClick:s},{default:o(()=>t[10]||(t[10]=[k("Bekor qilish")])),_:1}),a(U,{color:"success",type:"submit"},{default:o(()=>t[11]||(t[11]=[k("Saqlash")])),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])])}}},he={class:"text-center"},we={__name:"EditPermission",props:{updatingItem:Object,permissionDialog:{type:Boolean,default:!1}},emits:["updated","update:updateDialog"],setup(r,{emit:f}){const d=r,u=f,s=z(),p=V(null),b=V([]),i=V([]);function m(){u("update:updateDialog",!1)}async function _(){try{const t=await de();b.value=t||[]}catch(t){console.error(t),s.error("Rollarni olishda xatolik yuz berdi")}}async function x(){var t;try{const e=await me((t=d==null?void 0:d.updatingItem)==null?void 0:t.id);i.value=e||[]}catch(e){console.error(e),s.error("Foydalanuvchi rollarini olishda xatolik")}}async function n(){var C;const{valid:t}=await p.value.validate();if(!t)return;const e=i.value.map(w=>w.id),l=(C=d==null?void 0:d.updatingItem)==null?void 0:C.id;try{const{result:w}=await fe(e,l);w==="Ok"?(s.success("Muvofaqqiyatli yangilandi."),u("update:updateDialog",!1)):s.error("Xatolik yuz berdi")}catch(w){s.error("Server xatosi: "+w.message)}}return Y(()=>{_()}),W(()=>d.permissionDialog,t=>{t&&x()}),(t,e)=>(F(),A("div",he,[a(R,{modelValue:d.permissionDialog,"onUpdate:modelValue":e[1]||(e[1]=l=>d.permissionDialog=l),"max-width":"800"},{default:o(()=>[a(j,{class:"pa-4"},{default:o(()=>[a(I,null,{default:o(()=>e[2]||(e[2]=[k(" Xodim rollarini o'zgartirish ")])),_:1}),a(B,{class:"mb-4"}),a(H,{ref_key:"form",ref:p,onSubmit:N(n,["prevent"])},{default:o(()=>[a(S,null,{default:o(()=>[a(y,{cols:"12"},{default:o(()=>[a(D,{modelValue:i.value,"onUpdate:modelValue":e[0]||(e[0]=l=>i.value=l),items:b.value,"item-title":"name","item-value":"id",label:"Xodim rollari",multiple:"","return-object":"",chips:"",clearable:"",rules:[l=>Array.isArray(l)&&l.length>0||"Kamida bitta rol tanlang!"],required:""},null,8,["modelValue","items","rules"])]),_:1})]),_:1}),a(M,{class:"d-flex justify-end mt-4"},{default:o(()=>[a(U,{color:"error",variant:"elevated",onClick:m},{default:o(()=>e[3]||(e[3]=[k("Bekor qilish")])),_:1}),a(U,{color:"success",type:"submit",variant:"elevated"},{default:o(()=>e[4]||(e[4]=[k("Saqlash")])),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"])]))}};function qe(r,f){const d=typeof r=="string"?le(r):r,u=De(d,f);return{mounted:u,updated:u,unmounted(s){G(null,s)}}}function De(r,f){return function(d,u,s){var n,t,e;const p=typeof f=="function"?f(u):f,b=((n=u.value)==null?void 0:n.text)??u.value??(p==null?void 0:p.text),i=ae(u.value)?u.value:{},m=()=>b??d.textContent,_=(s.ctx===u.instance.$?(t=Ce(s,u.instance.$))==null?void 0:t.provides:(e=s.ctx)==null?void 0:e.provides)??u.instance.$.provides,x=te(r,oe(p,i),m);x.appContext=Object.assign(Object.create(null),u.instance.$.appContext,{provides:_}),G(x,d)}}function Ce(r,f){const d=new Set,u=p=>{var b,i;for(const m of p){if(!m)continue;if(m===r||m.el&&r.el&&m.el===r.el)return!0;d.add(m);let _;if(m.suspense?_=u([m.ssContent]):Array.isArray(m.children)?_=u(m.children):(b=m.component)!=null&&b.vnode&&(_=u([(i=m.component)==null?void 0:i.subTree])),_)return _;d.delete(m)}return!1};if(!u([f.subTree]))return f;const s=Array.from(d).reverse();for(const p of s)if(p.component)return p.component;return f}const O=qe(Ve,r=>{var f;return{activator:"parent",location:(f=r.arg)==null?void 0:f.replace("-"," "),text:typeof r.value=="boolean"?void 0:r.value}}),Te={style:{"min-width":"180px"}},Ee={__name:"index",setup(r){const f=z(),d=ye(),u=V(!1),s=V([]),p=V(null);async function b(){u.value=!0;const c=await pe();u.value=!1,c!=null&&c.length&&(s.value=c)}const i=V([]);async function m(){const c=await ve();c!=null&&c.length&&(i.value=c)}V([]);const _=V([]);async function x(){const c=await be();c!=null&&c.length&&(_.value=c)}const n=V(!1),t=V(null),e=V(!1);function l(c){t.value=c,n.value=!0}async function C(){e.value=!0;const c=await ce(t.value.id);e.value=!1,c.status===200&&f.success("Muvofaqqiyatli o'chirildi"),n.value=!1,await b()}const w=V(!1);function Q(c){t.value=null,t.value=c,w.value=!0}const $=V(!1);function Z(c){t.value=null,t.value=c,$.value=!0}return Y(()=>{b(),m(),x()}),(c,v)=>(F(),A(ie,null,[a(Ue,{"update-dialog":w.value,"onUpdate:updateDialog":v[0]||(v[0]=g=>w.value=g),"department-list":_.value,"region-list":i.value,"updating-item":t.value,onUpdated:b},null,8,["update-dialog","department-list","region-list","updating-item"]),a(we,{"update-dialog":$.value,"onUpdate:updateDialog":v[1]||(v[1]=g=>$.value=g),"permission-dialog":$.value,"updating-item":t.value},null,8,["update-dialog","permission-dialog","updating-item"]),a(j,{flat:""},{default:o(()=>[a(S,{class:"ma-2"},{default:o(()=>[a(y,{cols:"12",md:"6"},{default:o(()=>[a(I,{class:"d-flex align-center pe-2"},{default:o(()=>v[7]||(v[7]=[k(" Xodimlar ro'yxati ")])),_:1})]),_:1}),a(y,{class:"d-flex",cols:"12",md:"6"},{default:o(()=>[a(h,{modelValue:p.value,"onUpdate:modelValue":v[2]||(v[2]=g=>p.value=g),clearable:"",density:"compact","hide-details":"",label:"qidirish...","prepend-inner-icon":"mdi-magnify"},null,8,["modelValue"]),a(ke,{"department-list":_.value,"region-list":i.value,onCreated:b},null,8,["department-list","region-list"])]),_:1})]),_:1}),a(B),a(ge,{search:p.value,"onUpdate:search":v[3]||(v[3]=g=>p.value=g),"filter-keys":["full_name","pinfl"],headers:ne(d).headers,items:s.value,loading:u.value,"fixed-header":"",height:"71vh","loading-text":"ma'lumotlar yuklanmoqda","no-data-text":"ma'lumot topilmadi"},{"item.id":o(({item:g,index:T})=>[k(P(T+1),1)]),"item.local_code":o(({item:g,index:T})=>{var L;return[X("div",null,P((L=g.local_code)==null?void 0:L.name),1)]}),"item.department":o(({item:g,index:T})=>{var L;return[X("div",null,P((L=g.department)==null?void 0:L.department_name),1)]}),"item.actions":o(({item:g})=>[X("div",Te,[q(a(U,{color:"warning",density:"default",icon:"mdi-pencil-circle",size:"x-large",variant:"plain",onClick:T=>Q(g)},null,8,["onClick"]),[[O,"O'zgartirish","bottom-end"]]),q(a(U,{color:"error",density:"default",icon:"mdi-delete",size:"x-large",variant:"plain",onClick:T=>l(g)},null,8,["onClick"]),[[O,"O'chirish","bottom-end"]]),q(a(U,{color:"black",density:"default",icon:"mdi-lock-reset",size:"x-large",variant:"plain",onClick:T=>Z(g)},null,8,["onClick"]),[[O,"Rollarni o'zgartirish","bottom-end"]])])]),_:1},8,["search","headers","items","loading"]),a(R,{modelValue:n.value,"onUpdate:modelValue":v[6]||(v[6]=g=>n.value=g),"max-width":"600",persistent:""},{default:o(()=>[a(j,{class:"pa-4"},{actions:o(()=>[a(se),a(U,{color:"success",onClick:v[5]||(v[5]=g=>n.value=!1)},{default:o(()=>v[9]||(v[9]=[k(" Bekor qilish ")])),_:1}),a(U,{loading:e.value,color:"error",onClick:C},{default:o(()=>v[10]||(v[10]=[k(" Tasdiqlash ")])),_:1},8,["loading"])]),default:o(()=>[a(I,{class:"text-center mb-4 font-weight-bold"},{default:o(()=>v[8]||(v[8]=[k(" Ushbu ma'lumotni o'chirishni tasdiqlaysizmi? ")])),_:1}),a(S,{class:"mb-4"},{default:o(()=>[a(y,{cols:"12",md:"12"},{default:o(()=>[a(h,{modelValue:t.value.full_name,"onUpdate:modelValue":v[4]||(v[4]=g=>t.value.full_name=g),label:"Xodim F.I.Sh",readonly:""},null,8,["modelValue"])]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})],64))}};export{Ee as default};
