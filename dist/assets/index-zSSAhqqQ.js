import{aD as R,a_ as F,r as v,w as U,o as A,f as q,e as t,b as e,$ as x,s as n,a2 as M,aW as w,a3 as _,d as C,D as W,a$ as G,t as j,m as H}from"./index-B_oSWYrq.js";import{g as J}from"./departement.servise-aklCRzxE.js";import{a as P,u as Q,g as X,d as Y}from"./doctors.servise-CGxr7SyD.js";import{V as I,b as B,d as L,c as Z}from"./VCard-ieIYkKM8.js";import{V as $}from"./VDivider-Bqrb8A5C.js";import{V as N}from"./VForm-DA9WJtpH.js";import{V as S,a as D}from"./VRow-CzOa9ATY.js";import{V as z}from"./VAutocomplete-C-OY1lbS.js";import{V as T}from"./filter-Cs5Vkrbs.js";import{V as h}from"./VAvatar-Bw1abjYH.js";import{V as ee}from"./VDataTableVirtual-BW1SwmgH.js";import"./axios-N4JvVCu6.js";import"./VImg-DF32ofzA.js";import"./VList-BjSlY4_B.js";import"./VCheckboxBtn-9dQfnW4S.js";import"./VChip-zOtxOips.js";const le=R("doctors",{state:()=>({headers:[{title:"№",align:"start",key:"id",sortable:!1},{title:"Имя пользователя",align:"start",key:"username"},{title:"Полное имя",align:"start",key:"full_name"},{title:"ID отдела",align:"start",key:"department_id"},{title:"Название отдела",align:"start",key:"department_name"},{title:"Специальность",align:"start",key:"speciality"},{title:"Действия",align:"start",key:"actions",sortable:!1}]}),actions:{}}),te={__name:"addDoctorsInfo",props:{modelValue:{type:Boolean,default:!1},departmentList:{type:Array,default:()=>[]}},emits:["update:modelValue","added"],setup(k,{emit:b}){const i=k,V=b,m=F(),y=v(null),d=v(i.modelValue);U(()=>i.modelValue,l=>{d.value=l}),U(d,l=>{V("update:modelValue",l)});const r=v({username:"",full_name:"",department_id:null,speciality:"",password:""});function s(){d.value=!1}async function p(){var o;const{valid:l}=await y.value.validate();if(!l)return;const a={...r.value};try{const g=await P(a);(g==null?void 0:g.status)===200||(g==null?void 0:g.status)===201?(m.success("Врач успешно добавлен!"),V("added"),s()):m.error(((o=g==null?void 0:g.data)==null?void 0:o.detail)||"Произошла ошибка при добавлении")}catch(g){console.error(g),m.error("Ошибка при подключении к серверу")}}return(l,a)=>(A(),q(T,{modelValue:d.value,"onUpdate:modelValue":a[5]||(a[5]=o=>d.value=o),"max-width":"800"},{default:t(()=>[e(I,{class:"pa-4"},{default:t(()=>[e(B,null,{default:t(()=>[e(x,{class:"me-2",color:"primary"},{default:t(()=>a[6]||(a[6]=[n(" mdi-doctor ")])),_:1}),a[7]||(a[7]=n(" Добавить врача "))]),_:1}),e($,{class:"mb-4"}),e(N,{ref_key:"form",ref:y,onSubmit:M(p,["prevent"])},{default:t(()=>[e(S,null,{default:t(()=>[e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:r.value.full_name,"onUpdate:modelValue":a[0]||(a[0]=o=>r.value.full_name=o),label:"Полное имя","prepend-inner-icon":"mdi-account",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:r.value.username,"onUpdate:modelValue":a[1]||(a[1]=o=>r.value.username=o),label:"Имя пользователя","prepend-inner-icon":"mdi-account-circle-outline",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:r.value.department_id,"onUpdate:modelValue":a[2]||(a[2]=o=>r.value.department_id=o),items:i.departmentList,"item-title":"name","item-value":"id",label:"Отделение","prepend-inner-icon":"mdi-hospital-building",clearable:"",required:"",rules:[o=>!!o||"Выберите отделение"]},null,8,["modelValue","items","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:r.value.speciality,"onUpdate:modelValue":a[3]||(a[3]=o=>r.value.speciality=o),label:"Специальность","prepend-inner-icon":"mdi-stethoscope",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:r.value.password,"onUpdate:modelValue":a[4]||(a[4]=o=>r.value.password=o),label:"Пароль",type:"password","prepend-inner-icon":"mdi-lock",required:"",rules:[o=>!!o||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1})]),_:1}),e(L,{class:"d-flex justify-end mt-4"},{default:t(()=>[e(_,{color:"error",onClick:s},{default:t(()=>[e(x,{left:""},{default:t(()=>a[8]||(a[8]=[n(" mdi-close ")])),_:1}),a[9]||(a[9]=n(" Отмена "))]),_:1}),e(_,{color:"success",type:"submit"},{default:t(()=>[e(x,{left:""},{default:t(()=>a[10]||(a[10]=[n(" mdi-content-save ")])),_:1}),a[11]||(a[11]=n(" Сохранить "))]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]))}},ae={__name:"DoctorEditDialog",props:{editDialog:{type:Boolean,default:!1},editingItem:{type:Object,default:()=>({})},departmentList:{type:Array,default:()=>[]}},emits:["updated","update:editDialog"],setup(k,{emit:b}){const i=k,V=b,m=F(),y=v(null),d=v({username:"",full_name:"",department_id:null,speciality:"",password:""});function r(){var p;V("update:editDialog",!1),(p=y.value)==null||p.reset()}U(()=>i.editDialog,p=>{if(p&&i.editingItem){const l=i.editingItem;d.value={username:(l==null?void 0:l.username)||"",full_name:(l==null?void 0:l.full_name)||"",department_id:(l==null?void 0:l.department_id)||null,speciality:(l==null?void 0:l.speciality)||"",password:""}}});async function s(){var a;const{valid:p}=await y.value.validate();if(!p)return;const l={username:d.value.username,full_name:d.value.full_name,department_id:d.value.department_id,speciality:d.value.speciality};d.value.password&&(l.password=d.value.password);try{const o=await Q(i.editingItem.id,l);(o==null?void 0:o.status)===200?(m.success("Данные врача успешно обновлены!"),V("updated"),r()):m.error(((a=o==null?void 0:o.data)==null?void 0:a.detail)||"Ошибка при обновлении")}catch(o){console.error(o),m.error("Ошибка при подключении к серверу")}}return(p,l)=>(A(),q(T,{modelValue:i.editDialog,"onUpdate:modelValue":l[5]||(l[5]=a=>i.editDialog=a),"max-width":"600"},{default:t(()=>[e(I,{class:"pa-4"},{default:t(()=>[e(B,null,{default:t(()=>[e(x,{class:"me-2",color:"primary"},{default:t(()=>l[6]||(l[6]=[n("mdi-account-edit")])),_:1}),l[7]||(l[7]=n(" Редактировать данные врача "))]),_:1}),e($,{class:"mb-4"}),e(N,{ref_key:"form",ref:y,onSubmit:M(s,["prevent"])},{default:t(()=>[e(S,null,{default:t(()=>[e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:d.value.full_name,"onUpdate:modelValue":l[0]||(l[0]=a=>d.value.full_name=a),label:"Полное имя","prepend-inner-icon":"mdi-account",required:"",rules:[a=>!!a||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:d.value.username,"onUpdate:modelValue":l[1]||(l[1]=a=>d.value.username=a),label:"Имя пользователя","prepend-inner-icon":"mdi-account-circle-outline",required:"",rules:[a=>!!a||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(z,{modelValue:d.value.department_id,"onUpdate:modelValue":l[2]||(l[2]=a=>d.value.department_id=a),items:i.departmentList,"item-title":"name","item-value":"id",label:"Отделение","prepend-inner-icon":"mdi-hospital-building",clearable:"",required:"",rules:[a=>!!a||"Выберите отделение"]},null,8,["modelValue","items","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:d.value.speciality,"onUpdate:modelValue":l[3]||(l[3]=a=>d.value.speciality=a),label:"Специальность","prepend-inner-icon":"mdi-stethoscope",required:"",rules:[a=>!!a||"Обязательное поле"]},null,8,["modelValue","rules"])]),_:1}),e(D,{cols:"12",md:"6"},{default:t(()=>[e(w,{modelValue:d.value.password,"onUpdate:modelValue":l[4]||(l[4]=a=>d.value.password=a),label:"Новый пароль (необязательно)",type:"password","prepend-inner-icon":"mdi-lock-reset"},null,8,["modelValue"])]),_:1})]),_:1}),e(L,{class:"d-flex justify-end mt-4"},{default:t(()=>[e(_,{color:"error",onClick:r},{default:t(()=>[e(x,{left:""},{default:t(()=>l[8]||(l[8]=[n("mdi-close")])),_:1}),l[9]||(l[9]=n(" Отмена "))]),_:1}),e(_,{color:"success",type:"submit"},{default:t(()=>[e(x,{left:""},{default:t(()=>l[10]||(l[10]=[n("mdi-content-save-edit")])),_:1}),l[11]||(l[11]=n(" Сохранить "))]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["modelValue"]))}},oe={__name:"doctorsDelete",props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","confirm","close"],setup(k,{emit:b}){const i=b,V=k,m=v(V.modelValue);U(()=>V.modelValue,r=>m.value=r);function y(){m.value=!1,i("update:modelValue",!1),i("close")}function d(){i("confirm"),y()}return(r,s)=>(A(),q(T,{modelValue:m.value,"onUpdate:modelValue":s[0]||(s[0]=p=>m.value=p),"max-width":"420",transition:"dialog-bottom-transition",persistent:""},{default:t(()=>[e(I,{class:"rounded-2xl py-6 px-4",elevation:"8"},{default:t(()=>[e(B,{class:"text-center"},{default:t(()=>[e(h,{size:"64",color:"error",class:"mb-2"},{default:t(()=>[e(x,{color:"white",size:"36"},{default:t(()=>s[1]||(s[1]=[n("mdi-delete-forever")])),_:1})]),_:1}),s[2]||(s[2]=C("div",{class:"text-h6 font-weight-bold"},"Удалить запись?",-1))]),_:1}),e(Z,{class:"text-center text-body-2 text-medium-emphasis"},{default:t(()=>s[3]||(s[3]=[n(" Вы уверены, что хотите удалить эту запись?"),C("br",null,null,-1),n(" Это действие невозможно отменить. ")])),_:1}),e(L,{class:"d-flex justify-center mt-4"},{default:t(()=>[e(_,{variant:"outlined",color:"grey",class:"rounded-xl px-6",onClick:y},{default:t(()=>[e(x,{left:""},{default:t(()=>s[4]||(s[4]=[n("mdi-close")])),_:1}),s[5]||(s[5]=n(" Отмена "))]),_:1}),e(_,{color:"error",class:"rounded-xl px-6",onClick:d},{default:t(()=>[e(x,{left:""},{default:t(()=>s[6]||(s[6]=[n("mdi-trash-can")])),_:1}),s[7]||(s[7]=n(" Удалить "))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]))}},de={style:{color:"#1976d2"}},se={class:"d-flex"},_e={__name:"index",setup(k){const b=v(!1),i=le(),V=v({}),m=v([]),y=v(""),d=v(!1),r=v(!1),s=v(!1),p=v([]);async function l(){b.value=!0;try{const f={query:y.value||""},u=await X(f);m.value=Array.isArray(u)?u:(u==null?void 0:u.data)||[]}catch(f){console.error("Ошибка:",f)}finally{b.value=!1}}async function a(){try{const f=await J();p.value=f}catch(f){console.error(f)}}const o=async()=>{try{await Y(V.value.id),await l()}catch(f){console.error(f)}};function g(){d.value=!0}function E(f){V.value=f,r.value=!0}function K(f){V.value=f,s.value=!0}return W(()=>{l(),a()}),(f,u)=>(A(),q(I,{flat:""},{default:t(()=>[e(S,{class:"ma-2 align-center"},{default:t(()=>[e(D,{cols:"12",md:"6"},{default:t(()=>[e(B,null,{default:t(()=>u[4]||(u[4]=[n("Список врачей")])),_:1})]),_:1}),e(D,{cols:"12",md:"4"},{default:t(()=>[e(w,{modelValue:y.value,"onUpdate:modelValue":u[0]||(u[0]=c=>y.value=c),label:"Поиск...","prepend-icon":"mdi-magnify",onKeyup:G(l,["enter"])},null,8,["modelValue"])]),_:1}),e(D,{cols:"12",md:"2",class:"text-right"},{default:t(()=>[e(_,{color:"primary",onClick:g},{default:t(()=>u[5]||(u[5]=[n(" Добавить ")])),_:1})]),_:1})]),_:1}),e($),e(ee,{headers:H(i).headers,items:m.value,loading:b.value,height:"70vh","loading-text":"Загрузка...","no-data-text":"Данные не найдены"},{"item.id":t(({index:c})=>[n(j(c+1),1)]),"item.username":t(({item:c})=>[C("span",de,j(c.username),1)]),"item.actions":t(({item:c})=>[C("div",se,[e(_,{icon:"mdi-pencil-circle",variant:"plain",color:"warning",onClick:O=>E(c)},null,8,["onClick"]),e(_,{icon:"mdi-delete",variant:"plain",color:"error",onClick:O=>K(c)},null,8,["onClick"])])]),_:1},8,["headers","items","loading"]),e(te,{modelValue:d.value,"onUpdate:modelValue":u[1]||(u[1]=c=>d.value=c),"department-list":p.value,onAdded:l},null,8,["modelValue","department-list"]),e(ae,{"edit-dialog":r.value,"onUpdate:editDialog":u[2]||(u[2]=c=>r.value=c),"department-list":p.value,"editing-item":V.value,onUpdated:l},null,8,["edit-dialog","department-list","editing-item"]),e(oe,{modelValue:s.value,"onUpdate:modelValue":u[3]||(u[3]=c=>s.value=c),onConfirm:o},null,8,["modelValue"])]),_:1}))}};export{_e as default};
